<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>사토시의지갑</title>
<style>
:root {
  --bg:#0e1621; --panel:#111c27; --panel2:#0f1924; --text:#e8f0f7;
  --muted:#9fb3c8; --green:#28d07f; --red:#ff5d73; --line:#1e2a36;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
.wrap{max-width:1250px;margin:28px auto;padding:0 16px}
.title{font-weight:800;font-size:28px;margin-bottom:12px}
.server{float:right;font-size:12px;color:var(--muted)}
.panel{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:14px;padding:16px}
.tabs{display:flex;gap:8px;margin-bottom:10px}
.tab{padding:8px 14px;border-radius:10px;border:1px solid var(--line);background:#0c1420;cursor:pointer}
.tab.active{background:#0a3a55;border-color:#135c87}
.search{display:flex;gap:8px;margin:10px 0}
.search input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#0b1621;color:var(--text)}
.btn{padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:#0c3450;color:#d8f3ff;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(10,1fr);gap:8px;margin-top:10px;font-size:12px;color:#bcd0e4}
.grid div{padding:8px;border:1px dashed transparent;border-radius:10px}
.list{background:#0b1520;border:1px solid var(--line);border-radius:14px;padding:14px}
.item{display:flex;justify-content:space-between;padding:8px 4px;border-bottom:1px dashed #172433}
.item:last-child{border-bottom:none}
.pos{color:var(--green);font-weight:700}
.neg{color:var(--red);font-weight:700}
.muted{color:#7f99b4}
.footer{margin-top:10px;color:#6f8aa6;font-size:11px}
code#server-text{color:#a6d4ff}
</style>
</head>
<body>
<div class="wrap">
  <div class="title">사토시의지갑
    <span class="server">서버: <code id="server-text"></code></span>
  </div>
  <div class="panel">
    <div class="tabs">
      <button class="tab active" data-ex="upbit">업비트</button>
      <button class="tab" data-ex="bithumb">빗썸</button>
    </div>
    <div class="search">
      <input id="q" placeholder="코인명/심볼/시장 (예: 비트코인, BTC, KRW-BTC, 리플)" />
      <button class="btn" id="btn-search">검색</button>
    </div>
    <div id="result" class="grid">
      <div>기준봉</div><div>시장상태</div><div>위험도</div><div>상승예상</div><div>하락예상</div>
      <div>매수1</div><div>매수2</div><div>매도1</div><div>매도2</div><div>손절</div>
    </div>
  </div>

  <div class="row" style="display:flex;gap:16px;margin-top:18px">
    <div style="flex:1">
      <div class="panel">
        <div style="display:flex;justify-content:space-between">
          <div>· 실시간 급등 (업비트)</div>
          <div class="muted" id="clock-upbit">—</div>
        </div>
        <div class="list" id="list-upbit"></div>
      </div>
    </div>
    <div style="flex:1">
      <div class="panel">
        <div style="display:flex;justify-content:space-between">
          <div>· 실시간 급등 (빗썸)</div>
          <div class="muted" id="clock-bithumb">—</div>
        </div>
        <div class="list" id="list-bithumb"></div>
      </div>
    </div>
  </div>

  <div class="footer">※ 정보 제공/교육용, 거래 책임은 이용자에게 있습니다.</div>
</div>

<script>
document.getElementById("server-text").textContent = location.origin;
const API_UPBIT="/api/upbit",API_BITHUMB="/api/bithumb";
const tabs=document.querySelectorAll(".tab");
let EX="upbit";
tabs.forEach(t=>t.addEventListener("click",()=>{tabs.forEach(x=>x.classList.remove("active"));t.classList.add("active");EX=t.dataset.ex;}));

const NAME_KR={
  "BTC":"비트코인","ETH":"이더리움","BCH":"비트코인캐시","ETC":"이더리움클래식",
  "XRP":"리플","DOGE":"도지코인","SOL":"솔라나","ADA":"에이다",
  "SHIB":"시바이누","CELO":"셀로","API3":"에이피아이쓰리","BNB":"바이낸스코인",
  "CAKE":"팬케이크스왑","ZETA":"제타","SOON":"순","NFT":"엔에프티","XTER":"엑스터","LISTA":"리스타","CAMP":"캠프"
};

function fmtp(v){const n=Number(v)||0;return (n>=0?"+":"")+n.toFixed(2)+"%";}
function fmtn(v){if(v===undefined)return"—";const n=Number(v);if(isNaN(n))return v;return n.toLocaleString("ko-KR",{maximumFractionDigits:3});}

function renderResult(obj){
  const fields=["base","market","risk","up","down","buy1","buy2","sell1","sell2","cut"];
  const vals={
    base:obj.base||"1분",
    market:obj.market||"업비트",
    risk:obj.risk||"낮음",
    up:fmtp(obj.up||0),
    down:fmtp(obj.down||0),
    buy1:fmtn(obj.buy1||0.018),
    buy2:fmtn(obj.buy2||0.018),
    sell1:fmtn(obj.sell1||0.018),
    sell2:fmtn(obj.sell2||0.018),
    cut:fmtn(obj.cut||0)
  };
  const grid=document.getElementById("result");
  grid.innerHTML="";
  fields.forEach(k=>{
    const d=document.createElement("div");
    d.textContent=vals[k];
    if(k==="up"&&parseFloat(vals[k])>0)d.style.color="var(--green)";
    if(k==="down"&&parseFloat(vals[k])<0)d.style.color="var(--red)";
    grid.appendChild(d);
  });
}

async function search(){
  const q=document.getElementById("q").value.trim();
  if(!q)return;
  const norm=q.toUpperCase().replace("KRW-","").replace(/\s+/g,"");
  const url=EX==="upbit"?`${API_UPBIT}?q=${norm}`:`${API_BITHUMB}?q=${norm}`;
  try{
    const r=await fetch(url);const j=await r.json();
    renderResult(j.data||j.result||j);
  }catch(e){alert("검색 오류:"+e);}
}

document.getElementById("btn-search").onclick=search;
document.getElementById("q").addEventListener("keydown",e=>{if(e.key==="Enter")search();});

async function refreshLists(){
  try{
    const [u,b]=await Promise.all([fetch(API_UPBIT),fetch(API_BITHUMB)]);
    const uj=await u.json(),bj=await b.json();
    renderList("list-upbit",uj.top||uj.data||[],document.getElementById("clock-upbit"));
    renderList("list-bithumb",bj.top||bj.data||[],document.getElementById("clock-bithumb"));
  }catch{}
}
function renderList(id,arr,clock){
  const el=document.getElementById(id);el.innerHTML="";
  (arr||[]).slice(0,10).forEach(r=>{
    const nameKR=NAME_KR[r.symbol]||r.name||r.symbol;
    const chg=Number(r.change||r.pct||0);
    el.innerHTML+=`<div class="item"><div>${nameKR}</div><div class="${chg>=0?'pos':'neg'}">${fmtp(chg)}</div></div>`;
  });
  clock.textContent=new Date().toLocaleTimeString("ko-KR");
}
refreshLists();setInterval(refreshLists,3000);
</script>
</body>
</html>
