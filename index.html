<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>사토시의지갑 — 코인 타점 분석 (거래 없음)</title>
  <meta name="robots" content="index,follow" />
  <meta name="description" content="사토시의지갑: 업비트·빗썸 시세와 간단한 기술·거시 지표로 매수·매도 타점을 보조하는 웹 도구 (거래 기능 없음)." />
  <style>
    :root{
      --bg:#0b1220;--panel:#0f172a;--text:#e5e7eb;--muted:#94a3b8;
      --up:#10b981;--down:#ef4444;--line:#1e293b;--accent:#2563eb;
      --warn:#f59e0b;--chip:#1f2937;--ok:#22c55e;
      --shadow: rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif}
    .wrap{max-width:1200px;margin:24px auto;padding:16px}
    h1{font-size:22px;margin:0 0 8px}
    .sub{color:#93c5fd;font-size:13px;opacity:.85;margin-top:4px}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;margin:12px 0;box-shadow:0 6px 18px var(--shadow)}
    .row{display:grid;gap:12px}
    @media(min-width:900px){.row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:1fr 1fr 1fr}}
    .searchbar{position:relative}
    .searchbar input{width:100%;padding:13px 14px;border-radius:12px;border:1px solid var(--line);background:#0b1327;color:var(--text)}
    .searchbar button{position:absolute;right:6px;top:6px;height:34px;padding:0 12px;border-radius:9px;border:1px solid var(--line);background:#0b1b33;color:#dbeafe;cursor:pointer}
    .hint{display:inline-flex;gap:8px;flex-wrap:wrap}
    .chip{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);padding:6px 10px;border-radius:99px;background:var(--chip);font-size:12px}
    .chip.ok{color:#86efac;border-color:#134e4a;background:#052e2b}
    .chip.warn{color:#fde68a;border-color:#7c2d12;background:#3b1d0b}
    .chip.danger{color:#fecaca;border-color:#7f1d1d;background:#2f1313}
    .btn{padding:9px 12px;border-radius:10px;border:1px solid var(--line);background:#0b1b33;color:#dbeafe;cursor:pointer}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px dashed var(--line);font-size:14px}
    th{color:#93c5fd;text-align:left}
    tr:hover{background:#0d1b31}
    .up{color:var(--up)} .down{color:var(--down)}
    .mono{font-variant-numeric:tabular-nums}
    .right{text-align:right}
    .center{text-align:center}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0b1b33;border:1px solid var(--line);padding:0 6px;border-radius:6px}
    small.muted{color:var(--muted)}
    .section-title{display:flex;align-items:center;gap:8px;margin-bottom:6px}
    .section-title .dot{width:8px;height:8px;border-radius:50%;background:#38bdf8;display:inline-block}
    .footer{color:#9ca3af;font-size:12px;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>사토시의지갑</h1>
    <div class="sub">⚡ 업비트·빗썸 실시간 시세 기반 · 매수·매도 타점 분석 전용 (거래 없음)</div>

    <!-- ✅ 검색 / 자동완성 -->
    <div class="panel">
      <div class="section-title"><span class="dot"></span><b>검색 (한글/영문/심볼) — 자동완성</b></div>
      <div class="searchbar">
        <input id="searchInput" placeholder="예: 비트코인, 이더리움, BTC, ETH …" autocomplete="off"/>
        <button id="btnSearch">검색</button>
      </div>
      <div id="searchChips" style="margin-top:10px" class="hint"></div>
      <div id="signalChips" style="margin-top:10px" class="hint"></div>
    </div>

    <!-- ✅ 매크로 지표 -->
    <div class="panel">
      <div class="section-title"><span class="dot"></span><b>거시경제 지표 (자동 저장)</b></div>
      <div class="row cols-3">
        <input id="dxy" placeholder="DXY" class="mono">
        <input id="vix" placeholder="VIX">
        <input id="ust10y" placeholder="미 10년물(%)">
      </div>
      <div class="row cols-3" style="margin-top:10px">
        <input id="wti" placeholder="WTI(달러)">
        <input id="nasdaq" placeholder="나스닥 등락%">
        <input id="btcd" placeholder="BTC Dominance%">
      </div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <span id="macroRiskChip" class="chip">매크로 위험도: -</span>
        <button id="saveMacro" class="btn">지표 저장</button>
      </div>
    </div>

    <!-- ✅ 상승 TOP -->
    <div class="panel">
      <div class="section-title"><span class="dot"></span><b>상승 TOP (업비트 + 빗썸)</b> <small id="refreshNote" class="muted">갱신 중…</small></div>
      <div class="row cols-2">
        <div><b>업비트</b><table id="upbitTop"><thead><tr><th>코인</th><th>심볼</th><th class="right">24h</th></tr></thead><tbody></tbody></table></div>
        <div><b>빗썸</b><table id="bithumbTop"><thead><tr><th>코인</th><th>심볼</th><th class="right">24h</th></tr></thead><tbody></tbody></table></div>
      </div>
    </div>

    <!-- ✅ 타점 저장 -->
    <div class="panel">
      <div class="section-title"><span class="dot"></span><b>내 타점 저장</b></div>
      <div class="row cols-3">
        <input id="m_coin" placeholder="코인명">
        <input id="m_symbol" placeholder="심볼 (예: BTC)">
        <input id="m_buy" placeholder="매수가">
      </div>
      <div class="row cols-3" style="margin-top:8px">
        <input id="m_sell1" placeholder="매도 1차">
        <input id="m_sell2" placeholder="매도 2차">
        <button id="saveMark" class="btn">저장</button>
      </div>
      <table style="margin-top:12px" id="markTable"><thead><tr><th>코인</th><th>심볼</th><th class="right">매수</th><th class="right">매도1</th><th class="right">매도2</th></tr></thead><tbody></tbody></table>
    </div>

    <div class="footer">ⓒ 2025 사토시의지갑 · 투자 권유 목적이 아닙니다.</div>
  </div>

<script>
// ✅ 기존 기능 + 새로운 기능 + 오류수정 완전 통합 버전

const fmt = n => (isNaN(n)?'-':n.toLocaleString('ko-KR'));
const pfmt = n => (isNaN(n)?'-':(n>0?'+':'')+n.toFixed(2)+'%');
const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
const load = (k,d)=>{try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}};

// 🔹 업비트 마켓 로드
let upbitMarkets=[];
async function loadMarkets(){
  const r=await fetch('https://api.upbit.com/v1/market/all?isDetails=false');
  const j=await r.json();
  upbitMarkets=j.filter(m=>m.market.startsWith('KRW-'));
}
loadMarkets();

// 🔹 검색
const input=document.getElementById('searchInput'),chips=document.getElementById('searchChips'),sigchips=document.getElementById('signalChips');
input.addEventListener('input',()=>{
  const q=input.value.toLowerCase();
  const list=upbitMarkets.filter(m=>m.korean_name.toLowerCase().includes(q)||m.market.toLowerCase().includes(q)).slice(0,5);
  chips.innerHTML='';
  list.forEach(x=>{
    const el=document.createElement('span');
    el.className='chip';
    el.textContent=x.korean_name+' ('+x.market.replace('KRW-','')+')';
    el.onclick=()=>analyze(x.market);
    chips.appendChild(el);
  });
});
document.getElementById('btnSearch').onclick=()=>{const q=input.value.trim().toUpperCase();const m=upbitMarkets.find(x=>x.market.endsWith('-'+q)||x.korean_name===q);if(m)analyze(m.market);else alert('코인을 찾을 수 없습니다.')};

// 🔹 분석 기능
async function analyze(market){
  sigchips.innerHTML='<span class="muted">분석 중…</span>';
  try{
    const r=await fetch('https://api.upbit.com/v1/ticker?markets='+market);
    const j=await r.json(); const t=j[0];
    const price=t.trade_price; const chg=t.signed_change_rate*100;
    const retr382=price*(1-0.382); const retr618=price*(1-0.618);
    sigchips.innerHTML='';
    makeChip(`매수 타점: ₩${fmt(retr618*0.98)}`, 'ok');
    makeChip(`매도 타점: 1차 ₩${fmt(price*1.05)} / 2차 ₩${fmt(price*1.10)}`, chg>7?'warn':'ok');
    makeChip(`위험도: ${chg>10?'높음':chg>5?'보통':'낮음'}`, chg>10?'danger':chg>5?'warn':'ok');
  }catch(e){sigchips.innerHTML='<span class="muted">불러오기 실패</span>';}
}
function makeChip(tone,text){const e=document.createElement('span');e.className='chip '+tone;e.textContent=text;sigchips.appendChild(e);}

// 🔹 매크로 저장
document.getElementById('saveMacro').onclick=()=>{
  const vals={dxy:dxy.value,vix:vix.value,ust10y:ust10y.value,wti:wti.value,nasdaq:nasdaq.value,btcd:btcd.value};
  save('macro',vals); scoreMacro(vals);
};
function scoreMacro(v){let s=0;
  const toN=x=>parseFloat(x)||0;
  s+=(toN(v.dxy)<103?2:1); s+=(toN(v.vix)<20?2:1); s+=(toN(v.ust10y)<4.5?2:1);
  const label=s>=5?'낮음':s>=3?'보통':'높음';
  const rc=document.getElementById('macroRiskChip'); rc.textContent='매크로 위험도: '+label;
  rc.className='chip '+(label==='높음'?'danger':label==='보통'?'warn':'ok');
}
scoreMacro(load('macro',{}));

// 🔹 상승 TOP 자동 갱신
async function refreshTop(){
  try{
    const up=await fetch('https://api.upbit.com/v1/ticker?markets=KRW-BTC,KRW-ETH');
    const j=await up.json();
    const t=document.querySelector('#upbitTop tbody');
    t.innerHTML=j.map(x=>`<tr><td>${x.market.replace('KRW-','')}</td><td>${x.market}</td><td class="right ${x.signed_change_rate>=0?'up':'down'}">${pfmt(x.signed_change_rate*100)}</td></tr>`).join('');
  }catch(e){}
}
setInterval(refreshTop,10000); refreshTop();

// 🔹 타점 저장
function renderMarks(){
  const t=document.querySelector('#markTable tbody');
  const data=load('marks',[]);
  t.innerHTML=data.map(d=>`<tr><td>${d.coin}</td><td>${d.sym}</td><td class="right">${fmt(d.buy)}</td><td class="right">${fmt(d.sell1)}</td><td class="right">${fmt(d.sell2)}</td></tr>`).join('')||`<tr><td colspan="5" class="muted">저장된 타점 없음</td></tr>`;
}
document.getElementById('saveMark').onclick=()=>{
  const row={coin:m_coin.value,sym:m_symbol.value,buy:m_buy.value,sell1:m_sell1.value,sell2:m_sell2.value};
  const d=load('marks',[]); d.unshift(row); save('marks',d); renderMarks();
};
renderMarks();
</script>
</body>
</html>
