<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ì‚¬í† ì‹œì˜ì§€ê°‘ â€” ë§¤ìˆ˜Â·ë§¤ë„ íƒ€ì  ë¶„ì„ (ê±°ë˜/ê²°ì œ ì—†ìŒ)</title>
<meta name="description" content="ì—…ë¹„íŠ¸Â·ë¹—ì¸ ì‹œì„¸ ê¸°ë°˜ìœ¼ë¡œ ê²€ìƒ‰, ìë™ì™„ì„±, ë§¤ìˆ˜/ë§¤ë„ íƒ€ì , ë˜ëŒë¦¼(í”¼ë³´ë‚˜ì¹˜), ìœ„í—˜ë„(ATR%), ê±°ì‹œê²½ì œ ìŠ¤ì½”ì–´, ì €ì¥í•œ íƒ€ì , ìƒìŠ¹ TOP ë“±ì„ ì œê³µí•˜ëŠ” ë¸Œë¼ìš°ì € ê¸°ë°˜ ë„êµ¬ì…ë‹ˆë‹¤. ê±°ë˜/ê²°ì œ ê¸°ëŠ¥ì€ ì—†ìœ¼ë©° ì •ë³´ ì œê³µë§Œ í•©ë‹ˆë‹¤.">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%232563eb'/%3E%3Ctext x='50' y='63' font-size='60' text-anchor='middle' fill='white'%3ES%3C/text%3E%3C/svg%3E">
<style>
:root{--bg:#0b1220;--panel:#0f172a;--line:#1e293b;--text:#e5e7eb;--muted:#93a2b3;--accent:#2563eb;--up:#22c55e;--down:#ef4444;--warn:#f59e0b;}
*{box-sizing:border-box}
html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif}
.wrap{max-width:1200px;margin:24px auto;padding:0 16px}
h1{margin:0 0 6px;font-size:22px}
.sub{color:var(--muted);font-size:13px;margin-bottom:14px}
.panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;margin-bottom:16px}
.title{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.badge{display:inline-flex;gap:6px;align-items:center;padding:4px 10px;border:1px solid var(--line);border-radius:999px;background:#0c1526;font-size:12px}
.riskL{color:#86efac}.riskM{color:#fbbf24}.riskH{color:#fca5a5}
.note{color:var(--muted);font-size:12px}
.btn{padding:10px 14px;border-radius:10px;border:1px solid var(--line);background:#111827;color:#e5e7eb;cursor:pointer}
.btn:hover{background:#0c1220}
.search{display:flex;gap:8px;align-items:center;position:relative}
.search input{flex:1;padding:12px;border-radius:10px;border:1px solid var(--line);background:#0c1526;color:#9beaf9}
.ac{position:absolute;left:0;right:0;top:48px;background:#fff;color:#111;border:1px solid #e5e7eb;border-radius:10px;box-shadow:0 12px 28px rgba(0,0,0,.28);max-height:240px;overflow:auto;display:none;z-index:10}
.ac div{padding:10px 12px;cursor:pointer}
.ac div:hover,.ac .on{background:#eef2ff}
.grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}
.input{display:flex;flex-direction:column;gap:6px}
.input input{padding:10px;border-radius:10px;border:1px solid var(--line);background:#0c1526;color:#e5e7eb}
.table{width:100%;border-collapse:collapse}
th,td{padding:8px 6px;border-bottom:1px solid var(--line);font-size:13px}
th{color:#9fb3c8;text-align:left} td.r{text-align:right}
.sep{height:8px}
.one{margin-top:8px;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0c1526}
.savemsg{font-size:12px;color:#86efac;display:none;margin-left:8px}
.loading{font-size:12px;color:#93c5fd;margin-left:6px;display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>ì‚¬í† ì‹œì˜ì§€ê°‘</h1>
  <div class="sub">ê±°ë˜/ê²°ì œ ê¸°ëŠ¥ ì—†ìŒ Â· ë¸Œë¼ìš°ì € ë‚´ì—ì„œë§Œ ë™ì‘ Â· ì—…ë¹„íŠ¸/ë¹—ì¸ KRW ê¸°ì¤€</div>

  <!-- ê²€ìƒ‰/ë¶„ì„ -->
  <section class="panel">
    <div class="title">ğŸ” ê²€ìƒ‰(í•œê¸€/ì˜ë¬¸/ì‹¬ë³¼) â€” ìë™ì™„ì„± 5ê°œ <span id="load1" class="loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</span></div>
    <div class="search">
      <input id="q" placeholder="ì˜ˆ: ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€, KRW-SOL, DOGE ..." autocomplete="off" />
      <button class="btn" id="btnSearch">ê²€ìƒ‰</button>
      <div id="ac" class="ac"></div>
    </div>
    <div id="sel" style="display:none;margin-top:10px">
      <span class="badge"><b id="selName">-</b> <span id="selSym" style="opacity:.7"></span></span>
      <span class="badge">ê±°ë˜ì†Œ: <b id="selEx">ì—…ë¹„íŠ¸</b></span>
      <span class="badge">í˜„ì¬ê°€: â‚©<b id="selPrice">-</b></span>
      <span class="badge">24h: <b id="selPct">-</b></span>
      <span class="badge">ìŠ¤íƒ ìŠ¤: <b id="stance" class="riskM">ê´€ë§</b></span>
    </div>

    <div id="badges" style="display:none;margin-top:10px">
      <span class="badge">ë¶„ì„ ë§¤ìˆ˜íƒ€ì : <b id="autoBuy">-</b></span>
      <span class="badge">ë¶„ì„ ë§¤ë„íƒ€ì : <b id="autoSell1">-</b> / 2ì°¨ <b id="autoSell2">-</b></span>
      <span class="badge" id="riskBadge">ìœ„í—˜ë„: <b id="risk">-</b></span>
      <span class="badge" id="fib382" style="display:none">ë˜ëŒë¦¼ 38.2%: <b id="fib382v">-</b></span>
      <span class="badge" id="fib618" style="display:none">ë˜ëŒë¦¼ 61.8%: <b id="fib618v">-</b></span>
    </div>

    <!-- ê¸ˆì•¡ ì…ë ¥ -->
    <div class="grid" style="margin-top:10px">
      <div class="input"><label>ë§¤ìˆ˜ ê¸ˆì•¡(â‚©)</label><input id="buyKRW" placeholder="ì˜ˆ: 1,000,000"></div>
      <div class="input"><label>ë§¤ë„ 1ì°¨(â‚©)</label><input id="sell1KRW" placeholder="ì˜ˆ: 1,150,000"></div>
      <div class="input"><label>ë§¤ë„ 2ì°¨(â‚©)</label><input id="sell2KRW" placeholder="ì˜ˆ: 1,250,000"></div>
      <div class="input"><label>&nbsp;</label><button class="btn" id="btnSave">ì €ì¥</button><span id="saved" class="savemsg">ì €ì¥ë¨</span></div>
    </div>
    <div id="one" class="one" style="display:none"></div>
    <div class="note" style="margin-top:6px">â€» ìº¡ì²˜/ì´ë¯¸ì§€ ìš”ì†ŒëŠ” ì „ë¶€ ì œê±°ë¨. ë¸Œë¼ìš°ì € ì €ì¥(localStorage) ì‚¬ìš©.</div>
  </section>

  <!-- ê±°ì‹œê²½ì œ -->
  <section class="panel">
    <div class="title">ğŸŒ ê±°ì‹œê²½ì œ ì§€í‘œ (ìˆ˜ë™ ì…ë ¥ + ìë™ ìŠ¤ì½”ì–´)</div>
    <div class="grid">
      <div class="input"><label>DXY</label><input id="m_dxy" placeholder="ì˜ˆ: 105.2"></div>
      <div class="input"><label>VIX</label><input id="m_vix" placeholder="ì˜ˆ: 16.5"></div>
      <div class="input"><label>ç¾10Y(%)</label><input id="m_us10y" placeholder="ì˜ˆ: 4.45"></div>
      <div class="input"><label>WTI</label><input id="m_wti" placeholder="ì˜ˆ: 80.2"></div>
      <div class="input"><label>ë‚˜ìŠ¤ë‹¥(%)</label><input id="m_ndq" placeholder="ì˜ˆ: 0.85"></div>
      <div class="input"><label>BTC.D(%)</label><input id="m_bdc" placeholder="ì˜ˆ: 53.1"></div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <span class="badge" id="macroRiskB">ë§¤í¬ë¡œ ìœ„í—˜ë„: <b id="macroRisk">-</b></span>
      <span class="badge">íŒíŠ¸: <b id="macroHint">-</b></span>
      <button class="btn" id="macroSave">ì§€í‘œ ì €ì¥</button><span id="macroSaved" class="savemsg">ì €ì¥ë¨</span>
    </div>
  </section>

  <!-- ìƒìŠ¹ TOP -->
  <section class="panel">
    <div class="title">ğŸ“ˆ ìƒìŠ¹ TOP (ì—…ë¹„íŠ¸ Â· ë¹—ì¸) <span id="load2" class="loading">ê°±ì‹  ì¤‘â€¦</span></div>
    <div class="grid">
      <div>
        <b>ì—…ë¹„íŠ¸</b>
        <table class="table"><thead><tr><th>ì½”ì¸(í•œê¸€)</th><th>ì‹¬ë³¼</th><th class="r">24h</th><th class="r">ê±°ë˜ëŒ€ê¸ˆ(24h)</th></tr></thead><tbody id="upbitTop"></tbody></table>
      </div>
      <div>
        <b>ë¹—ì¸</b>
        <table class="table"><thead><tr><th>ì½”ì¸(í•œê¸€)</th><th>ì‹¬ë³¼</th><th class="r">24h</th><th class="r">ê±°ë˜ëŒ€ê¸ˆ(24h)</th></tr></thead><tbody id="bithumbTop"></tbody></table>
      </div>
    </div>
    <div class="note">10ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ </div>
  </section>

  <!-- ì €ì¥í•œ íƒ€ì  -->
  <section class="panel">
    <div class="title">ğŸ“ ë‚´ê°€ ì €ì¥í•œ íƒ€ì  (ì›í™”)</div>
    <table class="table">
      <thead><tr><th>ì½”ì¸(í•œê¸€)</th><th>ì‹¬ë³¼</th><th class="r">í˜„ì¬ê°€</th><th class="r">ë§¤ìˆ˜</th><th class="r">ë§¤ë„ 1ì°¨</th><th class="r">ë§¤ë„ 2ì°¨</th></tr></thead>
      <tbody id="myT"></tbody>
    </table>
    <div class="note">ì •ë³´ ì œê³µ/êµìœ¡ ëª©ì . íˆ¬ì/ê±°ë˜ ê¶Œìœ Â·ì§‘í–‰ì´ ì•„ë‹™ë‹ˆë‹¤.</div>
  </section>
</div>

<script>
const REFRESH=10, TOPN=15;
const fmtKRW = n => isFinite(n)? Number(n).toLocaleString('ko-KR',{maximumFractionDigits:0}) : '-';
const pct = x => `${x>=0?'+':''}${(x||0).toFixed(2)}%`;
const volKR = v => {v=+v||0; if(v>=1e12) return (v/1e12).toFixed(2)+'ì¡°'; if(v>=1e8) return (v/1e8).toFixed(2)+'ì–µ'; if(v>=1e4) return (v/1e4).toFixed(2)+'ë§Œ'; return fmtKRW(v);};
const deKRW = s => Number(String(s).replace(/[^0-9]/g,''))||0;

let ALL=[], KRW=[], NAME={};
async function loadMarkets(){
  if(KRW.length) return;
  const arr=await fetch('https://api.upbit.com/v1/market/all?isDetails=true').then(r=>r.json());
  KRW=arr.filter(x=>x.market.startsWith('KRW-'));
  NAME=Object.fromEntries(KRW.map(m=>[m.market,m.korean_name]));
}
/* ìë™ì™„ì„± */
const q=document.getElementById('q'), ac=document.getElementById('ac');
let acList=[], acSel=-1;
q.addEventListener('input', async () => {
  await loadMarkets();
  const k=(q.value||'').toLowerCase().trim();
  if(!k){ac.style.display='none';return;}
  const base=KRW.map(x=>({market:x.market, name:x.korean_name, sym:x.market.split('-')[1]}));
  acList = base.filter(x=>x.name.toLowerCase().includes(k)||x.sym.toLowerCase().includes(k)||x.market.toLowerCase().includes(k)).slice(0,5);
  ac.innerHTML = acList.map((x,i)=>`<div class="${i===acSel?'on':''}" data-m="${x.market}" data-name="${x.name}" data-sym="${x.sym}">${x.name} (${x.sym})</div>`).join('');
  ac.style.display = acList.length?'block':'none';
});
ac.addEventListener('click', e=>{
  const el=e.target.closest('div'); if(!el) return;
  q.value = el.dataset.name; ac.style.display='none';
  doSearch({market:el.dataset.m, name:el.dataset.name, sym:el.dataset.sym});
});
document.getElementById('btnSearch').addEventListener('click', ()=>doSearch());

/* ê¸°ìˆ  ê³„ì‚° */
function ema(vals, p){const k=2/(p+1);let e=vals[0];for(let i=1;i<vals.length;i++){e=vals[i]*k+e*(1-k);}return e;}
function atrPct(c, p=14){
  const n=Math.min(p+1,c.length); if(n<2) return 0;
  let trs=[]; for(let i=0;i<n-1;i++){const h=c[i].high_price,l=c[i].low_price,pc=c[i+1].trade_price; trs.push(Math.max(h-l,Math.abs(h-pc),Math.abs(l-pc)));}
  const atr=trs.reduce((a,b)=>a+b,0)/trs.length; return (atr/(c[0].trade_price||1))*100;
}
function swing(c, lb=30){let hi=-1e18,lo=1e18;for(let i=0;i<Math.min(lb,c.length);i++){hi=Math.max(hi,c[i].high_price);lo=Math.min(lo,c[i].low_price);}return{hi,lo,ran:hi-lo};}
function targets(c){
  const closes=c.map(x=>x.trade_price), close=closes[0];
  const ema20=ema(closes.slice().reverse().slice(-60),20);
  const ema60=ema(closes.slice().reverse().slice(-60),60);
  const up = ema20>ema60 && close>ema20;
  const {hi,lo,ran}=swing(c,30); const f382=hi-ran*0.382, f618=hi-ran*0.618;
  let buy,s1,s2,why=[];
  if(up){ buy=Math.max(f382,ema20)*0.998; s1=Math.min(hi,ema20*1.05); s2=hi; why.push('ìƒìŠ¹: 38.2%/EMA20 ë¶„í• ë§¤ìˆ˜ Â· 1ì°¨ ê³ ì /EMA20 í™•ì¥ Â· 2ì°¨ ì§ì „ê³ ì ');}
  else{ buy=Math.max(f618,ema60*0.98); s1=Math.min(ema60*1.03,f382); s2=ema60*1.06; why.push('ì•½ì„¸: 61.8%/EMA60 ì €ì ë§¤ìˆ˜ Â· 1ì°¨ 38.2%/EMA60 ì €í•­ Â· 2ì°¨ EMA60 ìƒë‹¨');}
  return {buy,s1,s2,f382,f618,ema20,ema60,why};
}
function stance(risk, macro){
  if((risk==='ë‚®ìŒ'||risk==='ë³´í†µ') && (macro==='ë‚®ìŒ'||macro==='ë³´í†µ')) return {txt:'ê¸°íšŒ',cls:'riskL'};
  if(risk==='ë†’ìŒ' || macro==='ë†’ìŒ') return {txt:'ê²½ê³„',cls:'riskH'};
  return {txt:'ê´€ë§',cls:'riskM'};
}

/* ê±°ì‹œ */
function readMacro(){
  const g=id=>parseFloat((document.getElementById(id).value||'').replace(',','.'));
  return {dxy:g('m_dxy'), vix:g('m_vix'), u10:g('m_us10y'), wti:g('m_wti'), ndq:g('m_ndq'), bdc:g('m_bdc')};
}
function scoreMacro(m){
  let s=50,h=[];
  if(isFinite(m.dxy)){ if(m.dxy>105){s+=8;h.push('DXYâ†‘');} else if(m.dxy<103){s-=4;h.push('DXYâ†“');} }
  if(isFinite(m.vix)){ if(m.vix>=20){s+=10;h.push('VIX20+');} else if(m.vix<14){s-=6;h.push('VIXâ†“');} }
  if(isFinite(m.u10)){ if(m.u10>=4.5){s+=7;h.push('10Yâ†‘');} else if(m.u10<4.0){s-=4;h.push('10Yâ†“');} }
  if(isFinite(m.wti) and m.wti>=90){s+=4;h.push('ìœ ê°€â†‘')}
  if(isFinite(m.ndq)){ if(m.ndq<=-1){s+=6;h.push('ë‚˜ìŠ¤ë‹¥â†“');} else if(m.ndq>=1){s-=6;h.push('ë‚˜ìŠ¤ë‹¥â†‘');} }
  if(isFinite(m.bdc)){ if(m.bdc>=55){s+=3;h.push('BTC.Dâ†‘');} else if(m.bdc<=50){s-=2;h.push('BTC.Dâ†“');} }
  let txt='ë³´í†µ',cls='riskM'; if(s>=66){txt='ë†’ìŒ';cls='riskH'} else if(s<=34){txt='ë‚®ìŒ';cls='riskL'};
  return {txt,cls,h: h.length?h.join(' Â· '):'ì¤‘ë¦½'};
}
function saveMacro(){ localStorage.setItem('macro_v1', JSON.stringify(readMacro())); document.getElementById('macroSaved').style.display='inline'; setTimeout(()=>document.getElementById('macroSaved').style.display='none',1200); applyMacro(); }
function restoreMacro(){ try{const m=JSON.parse(localStorage.getItem('macro_v1')||'{}'); for(const [k,v] of Object.entries({m_dxy:m.dxy,m_vix:m.vix,m_us10y:m.u10,m_wti:m.wti,m_ndq:m.ndq,m_bdc:m.bdc})){ if(v!==undefined) document.getElementById(k).value=v; }}catch(e){} applyMacro(); }
function applyMacro(){ const r=scoreMacro(readMacro()); const b=document.getElementById('macroRiskB'); b.className='badge '+r.cls; document.getElementById('macroRisk').textContent=r.txt; document.getElementById('macroHint').textContent=r.h; }

document.getElementById('macroSave').addEventListener('click', saveMacro);
window.addEventListener('load', restoreMacro);

/* ê²€ìƒ‰ ì‹¤í–‰ */
async function doSearch(preset){
  document.getElementById('load1').style.display='inline';
  await loadMarkets();
  try{
    let target=preset;
    if(!target){
      const kw=(q.value||'').trim().toLowerCase();
      const base=KRW.map(x=>({market:x.market,name:x.korean_name,sym:x.market.split('-')[1]}));
      target = base.find(x=>x.name.toLowerCase()===kw||x.sym.toLowerCase()===kw||x.market.toLowerCase()===kw) || base.find(x=>x.name.toLowerCase().includes(kw)) || base.find(x=>x.sym.toLowerCase().includes(kw));
      if(!target){ alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”. (ì—…ë¹„íŠ¸ KRW ê¸°ì¤€)'); return; }
    }
    const [tk, cds] = await Promise.all([
      fetch('https://api.upbit.com/v1/ticker?markets='+target.market).then(r=>r.json()),
      fetch('https://api.upbit.com/v1/candles/days?market='+target.market+'&count=60').then(r=>r.json())
    ]);
    const t=tk?.[0]||{}, price=+t.trade_price||0, ch=((+t.signed_change_rate)||0)*100;
    document.getElementById('sel').style.display='block';
    document.getElementById('badges').style.display='block';
    document.getElementById('selName').textContent=target.name;
    document.getElementById('selSym').textContent='('+target.sym+')';
    document.getElementById('selPrice').textContent=fmtKRW(price);
    document.getElementById('selPct').textContent=pct(ch);
    document.getElementById('selEx').textContent='ì—…ë¹„íŠ¸ KRW';
    if(Array.isArray(cds)&&cds.length){
      const zs=targets(cds), atr=atrPct(cds,14);
      const risk = atr>=6?'ë†’ìŒ':(atr>=3.5?'ë³´í†µ':'ë‚®ìŒ');
      const m=scoreMacro(readMacro());
      const st=stance(risk,m.txt); const stEl=document.getElementById('stance'); stEl.textContent=st.txt; stEl.className=st.cls;
      document.getElementById('autoBuy').textContent='â‚©'+fmtKRW(zs.buy);
      document.getElementById('autoSell1').textContent='â‚©'+fmtKRW(zs.s1);
      document.getElementById('autoSell2').textContent='â‚©'+fmtKRW(zs.s2);
      document.getElementById('risk').textContent=risk; document.getElementById('riskBadge').className='badge '+(risk==='ë†’ìŒ'?'riskH':risk==='ë³´í†µ'?'riskM':'riskL');
      document.getElementById('fib382').style.display='inline-flex'; document.getElementById('fib618').style.display='inline-flex';
      document.getElementById('fib382v').textContent='â‚©'+fmtKRW(zs.f382); document.getElementById('fib618v').textContent='â‚©'+fmtKRW(zs.f618);
      document.getElementById('one').style.display='block';
      document.getElementById('one').textContent = `${target.name} Â· ê¸°ìˆ ìš”ì•½: ${zs.why.join(' ')} Â· ë§¤í¬ë¡œ ${m.txt}(${m.h})`;
    }
    window.__cur = {name:target.name, sym:target.sym, market:target.market, price};
  }finally{ document.getElementById('load1').style.display='none'; }
}
document.getElementById('btnSearch').addEventListener('click', ()=>doSearch());

/* ì €ì¥/ëª©ë¡ */
function getMy(){ try{return JSON.parse(localStorage.getItem('my_targets_v1')||'[]')}catch(e){return[]} }
function setMy(x){ localStorage.setItem('my_targets_v1', JSON.stringify(x)); }
document.getElementById('btnSave').addEventListener('click', ()=>{
  const cur=window.__cur; if(!cur){alert('ë¨¼ì € ì½”ì¸ì„ ê²€ìƒ‰í•´ ì£¼ì„¸ìš”.'); return;}
  const a=deKRW(document.getElementById('buyKRW').value);
  const b=deKRW(document.getElementById('sell1KRW').value);
  const c=deKRW(document.getElementById('sell2KRW').value);
  const list=getMy().filter(r=>r.market!==cur.market);
  list.unshift({name:cur.name, sym:cur.sym, market:cur.market, buy:a, s1:b, s2:c, t:Date.now()});
  setMy(list.slice(0,100));
  document.getElementById('saved').style.display='inline'; setTimeout(()=>document.getElementById('saved').style.display='none',1200);
  renderMy(); 
});
async function renderMy(){
  const list=getMy(); const tb=document.getElementById('myT'); tb.innerHTML='';
  for(const r of list){
    let price='-'; try{ const t=await fetch('https://api.upbit.com/v1/ticker?markets='+r.market).then(x=>x.json()); price=fmtKRW(t?.[0]?.trade_price||0);}catch(e){}
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.name}</td><td>${r.sym}</td><td class="r">â‚©${price}</td><td class="r">â‚©${fmtKRW(r.buy)}</td><td class="r">â‚©${fmtKRW(r.s1)}</td><td class="r">â‚©${fmtKRW(r.s2)}</td>`;
    tb.appendChild(tr);
  }
}
renderMy();

/* ìƒìŠ¹ TOP */
async function loadUpbitTop(){
  try{
    const ms=await fetch('https://api.upbit.com/v1/market/all?isDetails=true').then(r=>r.json());
    const krw=ms.filter(x=>x.market.startsWith('KRW-'));
    const tick=await fetch('https://api.upbit.com/v1/ticker?markets='+krw.map(x=>x.market).join(',')).then(r=>r.json());
    const map=Object.fromEntries(krw.map(x=>[x.market,{name:x.korean_name,sym:x.market.split('-')[1]}]));
    const rows=tick.map(t=>{
      const m=map[t.market]; return {name:m.name, sym:m.sym, ch:(t.signed_change_rate||0)*100, vol:t.acc_trade_price_24h||0};
    }).sort((a,b)=>b.ch-a.ch).slice(0,TOPN);
    const tb=document.getElementById('upbitTop'); tb.innerHTML=rows.map(r=>`<tr><td>${r.name}</td><td>${r.sym}</td><td class="r">${pct(r.ch)}</td><td class="r">${volKR(r.vol)}</td></tr>`).join('');
  }catch(e){ console.warn('upbit top err',e); }
}
async function loadBithumbTop(){
  try{
    const res=await fetch('https://api.bithumb.com/public/ticker/ALL_KRW').then(r=>r.json());
    const data=res?.data||{}; const rows=Object.entries(data).filter(([k])=>k!=='date').map(([sym,v])=>{
      return {name:sym, sym:sym, ch:parseFloat(v.fluctate_rate_24H)||0, vol:parseFloat(v.acc_trade_value_24H)||0};
    }).sort((a,b)=>b.ch-a.ch).slice(0,TOPN);
    const tb=document.getElementById('bithumbTop'); tb.innerHTML=rows.map(r=>`<tr><td>${r.name}</td><td>${r.sym}</td><td class="r">${pct(r.ch)}</td><td class="r">${volKR(r.vol)}</td></tr>`).join('');
  }catch(e){ console.warn('bithumb top err',e); }
}
async function refreshTops(){ document.getElementById('load2').style.display='inline'; await Promise.all([loadUpbitTop(),loadBithumbTop()]); document.getElementById('load2').style.display='none'; }
refreshTops(); setInterval(refreshTops, REFRESH*1000);
</script>
</body>
</html>
