<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‚¬í† ì‹œì˜ì§€ê°‘</title>
<style>
body {
  font-family: "Pretendard", "Noto Sans KR", sans-serif;
  background-color: #0e1525;
  color: #d7e1ff;
  text-align: center;
  padding: 40px;
}
input {
  padding: 10px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  width: 220px;
  text-align: center;
  margin-top: 20px;
}
button {
  padding: 10px 18px;
  margin-left: 5px;
  border: none;
  border-radius: 8px;
  background: #007aff;
  color: white;
  cursor: pointer;
}
.badge {
  display: inline-block;
  margin: 6px;
  padding: 6px 10px;
  border-radius: 12px;
  background: #111a2a;
  color: #d0e0ff;
  font-size: 13px;
  border: 1px solid #26344d;
}
h1 { color: #77aaff; }
</style>
</head>
<body>
  <h1>ğŸ’ ì‚¬í† ì‹œì˜ì§€ê°‘ ğŸ’</h1>
  <input id="coinInput" placeholder="ì½”ì¸ ì´ë¦„ (ì˜ˆ: ë¹„íŠ¸ì½”ì¸)">
  <button onclick="update()">ê²€ìƒ‰</button>
  <div id="output"></div>

<script>
const MAP = {
  "ë¹„íŠ¸ì½”ì¸":"KRW-BTC","BTC":"KRW-BTC","KRW-BTC":"KRW-BTC",
  "ì´ë”ë¦¬ì›€":"KRW-ETH","ETH":"KRW-ETH","KRW-ETH":"KRW-ETH",
  "ì´ë”ë¦¬ì›€í´ë˜ì‹":"KRW-ETC","ETC":"KRW-ETC","KRW-ETC":"KRW-ETC",
  "ë¹„íŠ¸ì½”ì¸ìºì‹œ":"KRW-BCH","BCH":"KRW-BCH","KRW-BCH":"KRW-BCH",
  "ë„ì§€ì½”ì¸":"KRW-DOGE","DOGE":"KRW-DOGE","KRW-DOGE":"KRW-DOGE"
};
const fmt = n => "â‚©" + Math.round(n).toLocaleString("ko-KR");

async function getTicker(market){
  const r = await fetch(`https://api.upbit.com/v1/ticker?markets=${market}`);
  const [d] = await r.json();
  return d.trade_price;
}
async function getCandles(market){
  const r = await fetch(`https://api.upbit.com/v1/candles/minutes/1?market=${market}&count=200`);
  const d = await r.json();
  return d.reverse().map(x=>x.trade_price);
}

function ema(values, period){
  const k=2/(period+1);
  let emaPrev=values.slice(0,period).reduce((a,b)=>a+b)/period;
  const out=[...Array(period-1).fill(null), emaPrev];
  for(let i=period;i<values.length;i++){
    emaPrev = values[i]*k + emaPrev*(1-k);
    out.push(emaPrev);
  }
  return out;
}

function rsi(values, period=14){
  let gains=0,losses=0;
  for(let i=1;i<=period;i++){
    const diff = values[i]-values[i-1];
    if(diff>=0) gains+=diff; else losses-=diff;
  }
  let avgG=gains/period, avgL=losses/period;
  const out=[...Array(period).fill(null)];
  for(let i=period+1;i<values.length;i++){
    const diff = values[i]-values[i-1];
    const g=Math.max(diff,0), l=Math.max(-diff,0);
    avgG=(avgG*(period-1)+g)/period;
    avgL=(avgL*(period-1)+l)/period;
    const rs = avgL===0 ? 100 : avgG/avgL;
    out.push(100-(100/(1+rs)));
  }
  return out;
}

function analyze(price, closes){
  const ema12 = ema(closes,12).at(-1);
  const ema26 = ema(closes,26).at(-1);
  const rsi14 = rsi(closes,14).at(-1);
  const bullish = ema12>ema26;
  let tgt = bullish ? 0.012 : 0.008;
  let retr = bullish ? 0.006 : 0.009;
  if(rsi14>=70){tgt=0.006; retr=0.014;}
  else if(rsi14<=30){tgt=0.016; retr=0.004;}
  const buy = price*(1-retr);
  const sell1 = price*(1+tgt);
  const sell2 = price*(1+tgt*1.6);
  const risk = rsi14>=75?"ë†’ìŒ":rsi14<=25?"ë‚®ìŒ":bullish?"ë³´í†µ(ìƒìŠ¹)":"ë³´í†µ(í•˜ë½)";
  return {price,buy,sell1,sell2,rsi14,risk};
}

async function update(){
  const name=document.getElementById("coinInput").value.trim();
  const market=MAP[name]||name||"KRW-BTC";
  const [price,closes]=await Promise.all([getTicker(market),getCandles(market)]);
  const r=analyze(price,closes);
  document.getElementById("output").innerHTML = `
    <div class='badge'>í˜„ì¬ê°€: ${fmt(r.price)}</div>
    <div class='badge'>ë§¤ìˆ˜íƒ€ì : ${fmt(r.buy)}</div>
    <div class='badge'>1ì°¨ë§¤ë„: ${fmt(r.sell1)}</div>
    <div class='badge'>2ì°¨ë§¤ë„: ${fmt(r.sell2)}</div>
    <div class='badge'>RSI: ${r.rsi14.toFixed(2)}</div>
    <div class='badge'>ìœ„í—˜ë„: ${r.risk}</div>
  `;
}
</script>
</body>
</html>
