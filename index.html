<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‚¬í† ì‹œì˜ì§€ê°‘ â€” ì½”ì¸ íƒ€ì  ë¶„ì„ (ê±°ë˜ ì—†ìŒ)</title>
  <meta name="robots" content="index,follow" />
  <meta name="description" content="ì‚¬í† ì‹œì˜ì§€ê°‘: ì—…ë¹„íŠ¸Â·ë¹—ì¸ ì‹œì„¸ì™€ ê°„ë‹¨í•œ ê¸°ìˆ Â·ê±°ì‹œ ì§€í‘œë¡œ ë§¤ìˆ˜Â·ë§¤ë„ íƒ€ì ì„ ë³´ì¡°í•˜ëŠ” ì›¹ ë„êµ¬ (ê±°ë˜ ê¸°ëŠ¥ ì—†ìŒ)." />
  <style>
    :root{ --bg:#0b1220;--panel:#0f172a;--text:#e5e7eb;--muted:#94a3b8;
      --up:#10b981;--down:#ef4444;--line:#1e293b;--accent:#2563eb;--warn:#f59e0b;--chip:#1f2937;--ok:#22c55e;--bad:#ef4444;--shadow: rgba(0,0,0,.35); }
    *{box-sizing:border-box}
    html,body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif}
    .wrap{max-width:1200px;margin:24px auto;padding:16px}
    h1{font-size:22px;margin:0 0 8px}
    .sub{color:#93c5fd;font-size:13px;opacity:.85;margin-top:4px}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;margin:12px 0;box-shadow:0 6px 18px var(--shadow)}
    .row{display:grid;gap:12px}
    @media(min-width:900px){.row.cols-2{grid-template-columns:1fr 1fr} .row.cols-3{grid-template-columns:1fr 1fr 1fr}}
    .searchbar{position:relative}
    .searchbar input{width:100%;padding:13px 14px;border-radius:12px;border:1px solid var(--line);background:#0b1327;color:var(--text)}
    .searchbar button{position:absolute;right:6px;top:6px;height:34px;padding:0 12px;border-radius:9px;border:1px solid var(--line);background:#0b1b33;color:#dbeafe;cursor:pointer}
    .hint{display:inline-flex;gap:8px;flex-wrap:wrap}
    .chip{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);padding:6px 10px;border-radius:99px;background:var(--chip);font-size:12px}
    .chip.ok{color:#86efac;border-color:#134e4a;background:#052e2b}
    .chip.warn{color:#fde68a;border-color:#7c2d12;background:#3b1d0b}
    .chip.danger{color:#fecaca;border-color:#7f1d1d;background:#2f1313}
    .btn{padding:9px 12px;border-radius:10px;border:1px solid var(--line);background:#0b1b33;color:#dbeafe;cursor:pointer}
    .btn.sec{background:#111827;color:#cbd5e1}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px dashed var(--line);font-size:14px}
    th{color:#93c5fd;text-align:left}
    tr:hover{background:#0d1b31}
    .up{color:var(--up)} .down{color:var(--down)}
    .mono{font-variant-numeric:tabular-nums}
    .right{text-align:right}
    .muted{color:#94a3b8}
    .section-title{display:flex;align-items:center;gap:8px;margin-bottom:6px}
    .section-title .dot{width:8px;height:8px;border-radius:50%;background:#38bdf8;display:inline-block}
    .footer{color:#9ca3af;font-size:12px;margin-top:10px}
    .status{display:flex;gap:10px;flex-wrap:wrap}
    .badge{font-size:12px;padding:5px 8px;border-radius:8px;border:1px solid var(--line);background:#0b1b33}
    .badge.err{color:#fecaca;border-color:#7f1d1d;background:#2f1313}
  </style>
  <script src="./config.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>ì‚¬í† ì‹œì˜ì§€ê°‘</h1>
    <div class="sub">âš¡ ì—…ë¹„íŠ¸Â·ë¹—ì¸ ì‹œì„¸ ê¸°ë°˜ Â· ë§¤ìˆ˜Â·ë§¤ë„ íƒ€ì  ë¶„ì„ ì „ìš© (ê±°ë˜ ì—†ìŒ) Â· ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤</div>
    <div class="panel">
      <div class="section-title"><span class="dot"></span><b>ìƒíƒœ</b></div>
      <div class="status">
        <span id="sts-api" class="badge">API: -</span>
        <span id="sts-updated" class="badge">ì—…ë°ì´íŠ¸: -</span>
        <button id="btn-refresh" class="btn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button id="btn-auto" class="btn sec">â–¶ ìë™ê°±ì‹  ì¼œê¸°(1ì´ˆ)</button>
      </div>
    </div>
    <div class="panel">
      <div class="section-title"><span class="dot"></span><b>ê²€ìƒ‰ (í•œê¸€/ì˜ë¬¸/ì‹¬ë³¼) â€” ìë™ì™„ì„± 5ê°œ</b></div>
      <div class="searchbar">
        <input id="searchInput" placeholder="ì˜ˆ: ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€, BTC, ETH â€¦" autocomplete="off"/>
        <button id="btnSearch">ê²€ìƒ‰</button>
      </div>
      <div id="searchChips" style="margin-top:10px" class="hint"></div>
      <div id="signalChips" style="margin-top:10px" class="hint"></div>
    </div>
    <div class="panel">
      <div class="section-title"><span class="dot"></span><b>ìƒìŠ¹ TOP (ì—…ë¹„íŠ¸ Â· ë¹—ì¸ Â· í†µí•©)</b> <small id="refreshNote" class="muted" style="margin-left:8px">ê°±ì‹  ì¤‘â€¦</small></div>
      <div class="row cols-2">
        <div>
          <b>ì—…ë¹„íŠ¸</b>
          <table id="upbitTop"><thead><tr><th>ì½”ì¸(í•œê¸€)</th><th>ì‹¬ë³¼</th><th class="right">24h</th><th class="right">ê±°ë˜ëŒ€ê¸ˆ(24h)</th></tr></thead><tbody></tbody></table>
        </div>
        <div>
          <b>ë¹—ì¸</b>
          <table id="bithumbTop"><thead><tr><th>ì½”ì¸(í•œê¸€)</th><th>ì‹¬ë³¼</th><th class="right">24h</th><th class="right">ê±°ë˜ëŒ€ê¸ˆ(24h)</th></tr></thead><tbody></tbody></table>
        </div>
      </div>
      <div style="margin-top:12px">
        <b>í†µí•©</b>
        <table id="mergedTop"><thead><tr><th>ê±°ë˜ì†Œ</th><th>ì½”ì¸(í•œê¸€)</th><th>ì‹¬ë³¼</th><th class="right">24h</th><th class="right">ê±°ë˜ëŒ€ê¸ˆ(24h)</th></tr></thead><tbody></tbody></table>
        <small class="muted">1ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ </small>
      </div>
    </div>
    <div class="footer">ë³¸ ì„œë¹„ìŠ¤ëŠ” íˆ¬ì ê¶Œìœ /ì¤‘ê°œ/ì§‘í–‰ì´ ì•„ë‹ˆë©°, ì •ë³´ ì œê³µ ë° êµìœ¡ ëª©ì ì…ë‹ˆë‹¤. ê±°ë˜/ì†ì‹¤ ì±…ì„ì€ ì´ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.</div>
  </div>
<script>
const CFG = (window.APP_CONFIG || {});
const UPBIT_API = CFG.ENABLE_UPBIT_VERCEL_PROXY ? `${CFG.API_BASE}/api/upbit` : `https://api.upbit.com/v1`;
const BITHUMB_API = CFG.ENABLE_BITHUMB_VERCEL_PROXY ? `${CFG.API_BASE}/api/bithumb` : `https://api.bithumb.com`;

const $ = (id) => document.getElementById(id);
const fmt = (n) => (n===null||n===undefined||isNaN(n)) ? '-' : Number(n).toLocaleString('ko-KR');
const pfmt = (n) => isNaN(n) ? '-' : ((n>0?'+':'') + n.toFixed(2) + '%');

const stsApi = $('sts-api'), stsUpdated = $('sts-updated'), btnRefresh = $('btn-refresh'), btnAuto = $('btn-auto');
let timer = null;
function setStatus(ok,msg){ stsApi.textContent='API: '+msg; stsApi.className='badge'+(ok?'':' err'); }
function setUpdated(){ stsUpdated.textContent='ì—…ë°ì´íŠ¸: '+(new Date()).toLocaleString('ko-KR'); }

async function fetchUpbitTop(){
  try{
    const r = await fetch(`${UPBIT_API}?fn=top&n=15`, { cache:'no-store' });
    const j = await r.json();
    const rows = (j.data||[]).map(x=>({ name:(x.market||'').replace('KRW-',''), sym:(x.market||'').replace('KRW-',''),
      chg:(x.signed_change_rate||0)*100, vol:(x.acc_trade_price_24h||0) }));
    const top = rows.sort((a,b)=>b.chg-a.chg).slice(0,15);
    document.querySelector('#upbitTop tbody').innerHTML = top.map(v=>`<tr><td>${v.name}</td><td>${v.sym}</td><td class="${v.chg>=0?'up':'down'}">${pfmt(v.chg)}</td><td class="right">${fmt(Math.round(v.vol/1e8))} ì–µ</td></tr>`).join('');
    return top.map(v=>({ex:'ì—…ë¹„íŠ¸',...v}));
  }catch(e){
    document.querySelector('#upbitTop tbody').innerHTML = `<tr><td colspan="4" class="muted">ì—…ë¹„íŠ¸ ìš”ì²­ ì‹¤íŒ¨</td></tr>`;
    return [];
  }
}
async function fetchBithumbTop(){
  if (CFG.ENABLE_BITHUMB_VERCEL_PROXY) {
    try{
      const r = await fetch(`${BITHUMB_API}?fn=top&n=15`, { cache:'no-store' });
      if(!r.ok) throw 0;
      const j = await r.json();
      const list = (j.data||[]).map(v=>({ name:v.symbol, sym:v.symbol, chg:parseFloat(v.chg||0), vol:parseFloat(v.vol||0) }));
      document.querySelector('#bithumbTop tbody').innerHTML = list.map(v=>`<tr><td>${v.name}</td><td>${v.sym}</td><td class="${v.chg>=0?'up':'down'}">${pfmt(v.chg)}</td><td class="right">${fmt(Math.round(v.vol/1e8))} ì–µ</td></tr>`).join('');
      return list.map(v=>({ex:'ë¹—ì¸',...v}));
    }catch(e){ /* fallback below */ }
  }
  try{
    const r = await fetch('https://api.bithumb.com/public/ticker/ALL_KRW');
    const j = await r.json();
    if(j.status!=='0000') throw 0;
    const list = Object.entries(j.data).filter(([k,v])=>k!=='date' && v && v.fluctate_rate_24H)
      .map(([k,v])=>({ name:k, sym:k, chg:parseFloat(v.fluctate_rate_24H), vol:parseFloat(v.acc_trade_value_24H||0) }))
      .sort((a,b)=>b.chg-a.chg).slice(0,15);
    document.querySelector('#bithumbTop tbody').innerHTML = list.map(v=>`<tr><td>${v.name}</td><td>${v.sym}</td><td class="${v.chg>=0?'up':'down'}">${pfmt(v.chg)}</td><td class="right">${fmt(Math.round(v.vol/1e8))} ì–µ</td></tr>`).join('');
    return list.map(v=>({ex:'ë¹—ì¸',...v}));
  }catch(e){
    document.querySelector('#bithumbTop tbody').innerHTML = `<tr><td colspan="4" class="muted">ë¹—ì¸ ìš”ì²­ ì‹¤íŒ¨(CORS)</td></tr>`;
    return [];
  }
}
async function refreshAll(){
  $('refreshNote').textContent='ê°±ì‹  ì¤‘â€¦';
  const u = await fetchUpbitTop();
  const b = await fetchBithumbTop();
  const merged = [...u,...b].sort((a,b)=>b.chg-a.chg).slice(0,20);
  document.querySelector('#mergedTop tbody').innerHTML = merged.map(v=>`<tr>
    <td>${v.ex}</td><td>${v.name}</td><td>${v.sym}</td>
    <td class="${v.chg>=0?'up':'down'}">${pfmt(v.chg)}</td><td class="right">${fmt(Math.round((v.vol||0)/1e8))} ì–µ</td>
  </tr>`).join('');
  $('refreshNote').textContent='1ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ ';
  setUpdated();
}
btnRefresh.addEventListener('click', refreshAll);
btnAuto.addEventListener('click', ()=>{
  if(timer){ clearInterval(timer); timer=null; btnAuto.textContent='â–¶ ìë™ê°±ì‹  ì¼œê¸°(1ì´ˆ)'; }
  else { timer=setInterval(refreshAll, CFG.INTERVAL_TOP_MS || 1000); btnAuto.textContent='â¸ ìë™ê°±ì‹  ë„ê¸°'; refreshAll(); }
});
(function(){ refreshAll(); setInterval(refreshAll, CFG.INTERVAL_TOP_MS || 1000); })();
</script>
<script src="./config.js"></script>
<script src="./addons.js"></script>
  
</body>
</html>
