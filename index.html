<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì‚¬í† ì‹œì˜ì§€ê°‘ - ì—…ë¹„íŠ¸ ì‹¤ì‹œê°„ ì‹œì„¸</title>
  <style>
    body {
      font-family: Pretendard, system-ui, sans-serif;
      background: #f9fafb;
      padding: 20px;
      color: #111;
    }
    h1 {
      text-align: center;
      color: #0ea5e9;
    }
    #upbit-price-box {
      max-width: 480px;
      margin: 30px auto;
      padding: 16px;
      border-radius: 12px;
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      font-size: 15px;
      line-height: 1.8;
    }
    .coin-line {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #f3f4f6;
      padding: 6px 0;
    }
    .coin-line:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body>

  <h1>ğŸ’° ì‚¬í† ì‹œì˜ì§€ê°‘</h1>
  <p style="text-align:center;color:#555">ì—…ë¹„íŠ¸ ì‹¤ì‹œê°„ ì‹œì„¸ ì—°ê²° í…ŒìŠ¤íŠ¸</p>

  <!-- ì‹¤ì‹œê°„ ì‹œì„¸ ì˜ì—­ -->
  <div id="upbit-price-box">
    ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
  </div>

  <!-- ì—…ë¹„íŠ¸ ì‹¤ì‹œê°„ ì—°ê²° ì½”ë“œ -->
  <script type="module">
    import { getUpbitPrice } from "./api/upbit.js";

    async function updateAll() {
      const coins = ["KRW-BTC", "KRW-ETH", "KRW-DOGE", "KRW-AERGO"];
      const box = document.getElementById("upbit-price-box");
      box.innerHTML = "";
      for (const c of coins) {
        const price = await getUpbitPrice(c);
        const name = c.replace("KRW-", "");
        const line = `
          <div class="coin-line">
            <span>ğŸ’ ${name}</span>
            <b>${price ? price.toLocaleString("ko-KR") + " ì›" : "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨"}</b>
          </div>
        `;
        box.innerHTML += line;
      }
    }

    // ì²˜ìŒ ì‹¤í–‰ + 3ì´ˆë§ˆë‹¤ ê°±ì‹ 
    updateAll();
    setInterval(updateAll, 3000);
  </script>

</body><!-- ===== ZZE: ê¸°ì¡´ë‚´ìš© ìœ ì§€ + ì—…ë¹„íŠ¸ ì‹¤ì‹œê°„ + 8% ì˜ˆì¸¡ íŒ¨ë„ + ì˜¤ë¥˜ìˆ˜ì • (í•œ ë©ì–´ë¦¬) ===== -->
<script type="module">
/* ---------- 0) ê³µí†µ: ì•ˆì „í•œ í•œêµ­í˜• ìˆ«ì í¬ë§· (ì—…ë¹„íŠ¸ í˜¸ê°€ ì†Œìˆ˜ ì§€ì›) ---------- */
function fmtKRW(x, max=4){
  if(typeof x!=="number" || !isFinite(x)) return "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
  return x.toLocaleString("ko-KR", { maximumFractionDigits: max });
}

/* ---------- 1) ì—…ë¹„íŠ¸ ìœ í‹¸ ë¡œë“œ (api/upbit.js) ---------- */
import { getUpbitPrice } from "./api/upbit.js";

/* ---------- 2) ì—…ë¹„íŠ¸ ì‹¤ì‹œê°„ ì‹œì„¸ ë°•ìŠ¤: ê¸°ì¡´ ë ˆì´ì•„ì›ƒì— ë¹„ì¹¨ìŠµ ë¶€ì°© ---------- */
(function makePriceBox(){
  // UI ë§Œë“¤ê¸° (ê¸°ì¡´ êµ¬ì¡° ì•ˆ ë§ì¹˜ê³ , í˜ì´ì§€ ë§¨ ìœ„ì— ì¡°ìš©íˆ ì¶”ê°€)
  const box = document.createElement("div");
  box.id = "zz-upbit-box";
  box.style.cssText = "max-width:520px;margin:16px auto;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.05);font-family:system-ui,Pretendard,sans-serif";
  box.innerHTML = `
    <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap">
      <b>ğŸ’° ì—…ë¹„íŠ¸ ì‹¤ì‹œê°„ ì‹œì„¸</b>
      <small id="zz-upbit-ts" style="color:#64748b"></small>
    </div>
    <div id="zz-upbit-lines" style="margin-top:8px;font-size:14px;line-height:1.9">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  `;
  // ê°€ëŠ¥í•œ í•œ "ê²€ìƒ‰ì°½ ë°”ë¡œ ì•„ë˜"ì— ë†“ê¸°
  const searchSel=['#search','#searchBox','#search-area','#searchbar','input[type="search"]','.search','.search-box','.searchbar','[data-role="search"]'];
  let target=null;
  for(const s of searchSel){ const el=document.querySelector(s); if(el){ target=el.closest('.search')||el.parentElement||el; break; } }
  if(target?.parentNode) target.parentNode.insertBefore(box, target.nextSibling);
  else document.body.prepend(box); // ê²€ìƒ‰ì°½ì„ ëª» ì°¾ìœ¼ë©´ ë§¨ ìœ„

  // ì‹œì„¸ ê°±ì‹  ë£¨í”„ (ì˜¤ë¥˜ë‚´ì„±)
  const COINS = ["KRW-BTC","KRW-ETH","KRW-DOGE","KRW-AERGO"]; // â† ì›í•˜ëŠ” ì½”ì¸ ì¶”ê°€/ì‚­ì œ ê°€ëŠ¥
  async function render(){
    const wrap = document.getElementById("zz-upbit-lines");
    const tsEl = document.getElementById("zz-upbit-ts");
    if(!wrap) return;
    tsEl.textContent = "KST " + new Date().toLocaleString("ko-KR",{hour12:false});
    const parts=[];
    for(const mkt of COINS){
      const px = await getUpbitPrice(mkt);
      const name = mkt.replace("KRW-","");
      parts.push(`<div style="display:flex;justify-content:space-between;border-bottom:1px solid #f1f5f9;padding:4px 0">
        <span>ğŸ’ ${name}</span><b>${fmtKRW(px)}</b></div>`);
    }
    wrap.innerHTML = parts.join("");
  }
  render();
  setInterval(render, 3000); // 3ì´ˆ ìë™ê°±ì‹ 
})();

/* ---------- 3) 8%+ ìƒìŠ¹ ì˜ˆì¸¡ íŒ¨ë„ (ê²€ìƒ‰ë€ ì•„ë˜ ìë™ ë¶€ì°©) ---------- */
(function mountPredictor(){
  // ìŠ¤íƒ€ì¼ ì£¼ì…(ê¸°ì¡´ CSSì™€ ì¶©ëŒ ìµœì†Œí™”)
  const css = `
  .zz-predictor{font-family:system-ui,Pretendard,sans-serif;margin-top:12px}
  .zz-card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .zz-title{font-weight:700;font-size:14px;margin:0 0 8px}
  .zz-sub{font-size:12px;color:#6b7280;margin:2px 0 10px}
  .zz-table{width:100%;border-collapse:collapse;font-size:12px}
  .zz-table th,.zz-table td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:right;white-space:nowrap}
  .zz-table th:nth-child(1),.zz-table td:nth-child(1){text-align:left}
  .zz-chip{display:inline-block;padding:2px 8px;border-radius:9999px;font-size:11px}
  .zz-chip.low{background:#ecfeff;color:#0e7490}
  .zz-chip.mid{background:#fef9c3;color:#a16207}
  .zz-chip.high{background:#fee2e2;color:#b91c1c}
  .zz-badge{font-size:10px;color:#64748b;margin-left:6px}
  .zz-empty{padding:12px;color:#94a3b8}`;
  const st = document.createElement('style'); st.textContent = css; document.head.appendChild(st);

  // ê²€ìƒ‰ì°½ ì°¾ê¸°
  function findSearch(){
    const sel=['#search','#searchBox','#search-area','#searchbar','input[type="search"]','.search','.search-box','.searchbar','[data-role="search"]'];
    for(const s of sel){ const el=document.querySelector(s); if(el) return el.closest('.search')||el.parentElement||el; }
    return null;
  }
  // ì¹´ë“œ ìƒì„±
  function card(){
    const w=document.createElement('div'); w.className='zz-predictor';
    w.innerHTML=`
      <div class="zz-card">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap">
          <p class="zz-title">ğŸ“ˆ 8%+ ìƒìŠ¹ ì˜ˆìƒ ì½”ì¸ (TOP 10)</p>
          <span class="zz-badge" id="zz-lastts"></span>
        </div>
        <p class="zz-sub">ì„¸ë ¥ë§¤ì§‘Â·ë³€ë™ì„±(ATR/HV)Â·RSI/MACDÂ·ê±°ë˜ëŸ‰ ì¦ê°€ìœ¨ ì¢…í•©</p>
        <div id="zz-tablewrap"></div>
      </div>`;
    return w;
  }
  function riskChip(r){ if(r<=2) return '<span class="zz-chip low">ìœ„í—˜ë„ 1â€“2 (ë‚®ìŒ)</span>'; if(r==3) return '<span class="zz-chip mid">ìœ„í—˜ë„ 3 (ë³´í†µ)</span>'; return '<span class="zz-chip high">ìœ„í—˜ë„ 4â€“5 (ë†’ìŒ)</span>'; }
  function renderTable(rows){
    const host=document.getElementById('zz-tablewrap'), ts=document.getElementById('zz-lastts');
    if(!host) return;
    ts.textContent='KST ì—…ë°ì´íŠ¸: '+new Date().toLocaleString('ko-KR',{hour12:false});
    if(!rows||rows.length===0){ host.innerHTML='<div class="zz-empty">í˜„ì¬ ì˜ˆì¸¡ í›„ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. (ë°ì´í„° ëŒ€ê¸°)</div>'; return; }
    rows = rows.slice().sort((a,b)=>(b.predPct-a.predPct)||(b.prob-a.prob)).slice(0,10);
    host.innerHTML = `
      <table class="zz-table">
        <thead><tr><th>ì½”ì¸(í•œê¸€)</th><th>ì˜ˆì¸¡ìƒìŠ¹ë¥ </th><th>ê¸‰ë“±í™•ë¥ </th><th>ìœ„í—˜ë„</th><th>ê·¼ê±°(ìš”ì•½)</th></tr></thead>
        <tbody>${rows.map(r=>`<tr>
          <td>${r.nameKR} <span class="zz-badge">${r.symbol}</span></td>
          <td>${r.predPct.toFixed(1)}%</td>
          <td>${r.prob.toFixed(0)}%</td>
          <td>${riskChip(r.risk)}</td>
          <td>${r.signalNote||''}</td>
        </tr>`).join('')}</tbody>
      </table>`;
  }
  // ê°„ë‹¨ ìŠ¤ì½”ì–´ëŸ¬(ë°ëª¨ìš©) â€” ì‹¤ë°ì´í„° ì—°ê²° ì „
  function score(x){
    let s=0,n=[]; if(x.macdUp){s+=2;n.push('MACDâ†‘');}
    if(x.rsi&&x.rsi>52&&x.rsi<75){s+=2;n.push('RSI ìƒìŠ¹');}
    if(x.volUp&&x.volUp>1.5){s+=1.5;n.push('ê±°ë˜ëŸ‰â†‘');}
    if(x.obvSlope&&x.obvSlope>0){s+=1.5;n.push('OBVâ†‘');}
    if(x.cvdUp){s+=1;n.push('CVDâ†‘');}
    if(x.atrBand&&x.atrBand>0.6){s+=1;n.push('ë³€ë™ì„±');}
    const predPct=Math.min(25,4+s*2.2+(x.volUp?Math.min(6,(x.volUp-1)*3):0));
    const prob=Math.max(50,Math.min(95,55+s*6));
    const risk=(x.atrBand>0.9||(x.volUp&&x.volUp>2.5))?4:(x.rsi>72?3:2);
    return {predPct,prob,risk,note:n.join(' / ')};
  }
  // ì™¸ë¶€ ì—…ë°ì´íŠ¸ ì§„ì…ì (ì‹¤ë°ì´í„°ì—ì„œ ì´ í•¨ìˆ˜ë§Œ í˜¸ì¶œí•˜ë©´ ê°±ì‹ )
  window.ZZPredictor = {
    update(items){
      if(!Array.isArray(items)) return renderTable([]);
      const rows = items.map(c=>{ const s=score(c); return {
        nameKR:c.nameKR||c.symbol||'ì½”ì¸', symbol:c.symbol||'',
        predPct:s.predPct, prob:s.prob, risk:s.risk, signalNote:s.note
      };});
      renderTable(rows);
    }
  };

  // ì¥ì°©
  const t=findSearch(), p=card();
  if(t?.parentNode) t.parentNode.insertBefore(p, t.nextSibling); else document.body.appendChild(p);

  // ë°ëª¨ ë°ì´í„°(ë³´ì´ë©´ ì •ìƒ ì„¤ì¹˜). ì‹¤ë°ì´í„° ì—°ê²° ì‹œ ì•„ë˜ updateê°€ ë®ì–´ì”€.
  window.ZZPredictor.update([
    {nameKR:'ì´ë”ë¦¬ì›€', symbol:'ETH/KRW', rsi:59, macdUp:true, volUp:1.7, obvSlope:0.9, atrBand:0.6, cvdUp:true},
    {nameKR:'ì…€ë¡œ',     symbol:'CELO/KRW', rsi:63, macdUp:true, volUp:2.3, obvSlope:0.5, atrBand:0.8, cvdUp:true},
    {nameKR:'ì—ì–´ê³ ',   symbol:'AERGO/KRW', rsi:55, macdUp:true, volUp:1.6, obvSlope:0.4, atrBand:0.5, cvdUp:false}
  ]);
})();
</script>
<!-- ===== /ZZE block ===== -->

</html>
