<!DOCTYPE html><html lang='ko'><head><meta charset='utf-8'/><meta name='viewport' content='width=device-width, initial-scale=1'/><title>ì‚¬í† ì‹œì˜ì§€ê°‘ Â· ì›í´ë¦­</title><style>:root{--bg:#0e1116;--panel:#121722;--card:#1b2332;--text:#e6edf3;--sub:#9aa6b2;--up:#e74c3c;--down:#2ecc71;--line:#263244;--accent:#f0b90b}*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,Apple SD Gothic Neo,Malgun Gothic,system-ui,Segoe UI,Roboto,sans-serif}header{position:sticky;top:0;z-index:9;background:linear-gradient(180deg,#0f1420,#0e1116);border-bottom:1px solid var(--line);padding:12px 14px}header h1{margin:0;font-size:18px;display:flex;gap:8px;align-items:center}header h1::before{content:'';width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px var(--accent)}main{max-width:1240px;margin:18px auto;padding:0 14px 40px}.panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:12px;margin-bottom:12px}.title{font-size:13px;color:var(--sub);margin-bottom:6px;display:flex;gap:8px;align-items:center}.note{font-size:12px;color:var(--sub)} .row{display:grid;gap:10px}.cards{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px}.price{font-size:18px;font-weight:700}.chg{font-size:12px;margin-top:2px}.ok{color:var(--up)}.bad{color:var(--down)}.search{display:flex;gap:8px}.search input{flex:1;padding:9px 10px;border-radius:10px;border:1px solid var(--line);background:#0b0f17;color:var(--text)}.search button{padding:9px 12px;border-radius:10px;border:1px solid var(--line);background:#101826;color:var(--text);cursor:pointer}.grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}.grid3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}.input{display:flex;flex-direction:column;gap:6px}.input label{font-size:12px;color:var(--sub)}.input input{padding:9px 10px;border-radius:10px;border:1px solid var(--line);background:#0b0f17;color:var(--text)}.btn{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#1a2232;color:var(--text);cursor:pointer}.kv{display:flex;justify-content:space-between;font-size:13px;padding:6px 8px;border:1px dashed #223047;border-radius:10px}.kv b{color:#d6dee7} th,td{padding:6px 8px;border-bottom:1px dashed #223047;text-align:right}.table{width:100%;border-collapse:collapse}.side{display:flex;align-items:center;justify-content:space-between}.pill{font-size:11px;color:#000;background:#e6edf3;border-radius:999px;padding:2px 8px}.switch{display:flex;gap:10px;align-items:center} footer{margin-top:14px;font-size:11px;color:var(--sub)}@media(max-width:1000px){.cards{grid-template-columns:repeat(2,1fr)}.grid2,.grid3{grid-template-columns:1fr}}</style></head><body><header><h1>ì‚¬í† ì‹œì˜ì§€ê°‘ Â· ì›í´ë¦­ (ë”ë¸”í´ë¦­ ì‹¤í–‰ / ì‹¤ì‹œê°„)</h1></header><main>
<section class="panel">
  <div class="search">
    <input id="q" placeholder="ì˜ˆ: ì²´ì¸ë§í¬, ë¹„íŠ¸ì½”ì¸, KRW-SOLâ€¦"/>
    <button id="btnSearch">ê²€ìƒ‰</button>
    <button id="btnReset">ì´ˆê¸°í™”</button>
  </div>
  <div class="note">í•œê¸€/ì˜ë¬¸/ì‹¬ë³¼ ê²€ìƒ‰ â†’ ì—…ë¹„íŠ¸ KRW-* ìë™ ë§¤í•‘ Â· Enter ì§€ì›</div>
</section>
<section class="panel" id="tradeBox">
  <div class="title">ğŸ§® íŠ¸ë ˆì´ë“œ í”Œë˜ë„ˆ (KRW)
    <span class="switch">
      <label style="font-size:12px;color:#9aa6b2"><input id="autoPlan" type="checkbox" checked> ì‹¤ì‹œê°„ ìë™ íƒ€ì </label>
      <span id="lastPlanAt" class="pill">-</span>
    </span>
  </div>
  <div class="grid3">
    <div class="input"><label>ì‹¬ë³¼(ì—…ë¹„íŠ¸)</label><input id="selUp" value="KRW-BTC"/></div>
    <div class="input"><label>í˜„ì¬ê°€(ìë™)</label><input id="cur" readonly/></div>
    <div class="input"><label>ë§¤ìˆ˜ê°€</label><input id="entry" placeholder="ì˜ˆ: 74,000"/></div>
  </div>
  <div class="grid3" style="margin-top:8px">
    <div class="input"><label>ì†ì ˆ(%)</label><input id="slPct" type="number" step="0.1" value="0.8"/></div>
    <div class="input"><label>ìµì ˆ1(%)</label><input id="tp1Pct" type="number" step="0.1" value="1.2"/></div>
    <div class="input"><label>ìµì ˆ2(%)</label><input id="tp2Pct" type="number" step="0.1" value="2.5"/></div>
  </div>
  <div class="grid2" style="margin-top:8px">
    <button class="btn" id="btnFromCur">í˜„ì¬ê°€â†’ë§¤ìˆ˜ê°€ ë°˜ì˜</button>
    <button class="btn" id="btnPlan">íƒ€ì  ê³„ì‚°</button>
  </div>
  <div id="planOut" style="margin-top:10px" class="grid2">
    <div class="kv"><span>ì†ì ˆê°€</span><b id="slPrice">-</b></div>
    <div class="kv"><span>ìµì ˆ1</span><b id="tp1Price">-</b></div>
    <div class="kv"><span>ìµì ˆ2</span><b id="tp2Price">-</b></div>
    <div class="kv"><span>ì¬ë§¤ìˆ˜ ì¡´</span><b id="reBuyZone">-</b></div>
  </div>
</section>
<section class="panel" id="marketBox">
  <div class="title">ğŸ“Š ì‹œì¥ë¶„ì„ â€” MA20/60/200 Â· RSI14</div>
  <div id="marketReport" style="font-size:13px;line-height:1.5">-</div>
</section>
<section class="panel" id="spikeDropBox">
  <div class="title">âš¡ ê¸‰ë“±/ê¸‰ë½ í•«ë¦¬ìŠ¤íŠ¸
    <span id="hotStat" class="pill">ì—°ê²° ì¤€ë¹„</span>
    <label style="font-size:12px;color:#9aa6b2"><input id="soundOn" type="checkbox" checked> ì•Œë¦¼ìŒ</label>
  </div>
  <div class="row" style="grid-template-columns:1fr 1fr">
    <div><b>ê¸‰ë“±(Up)</b><ul id="hotUpList"></ul></div>
    <div><b>ê¸‰ë½(Down)</b><ul id="hotDownList"></ul></div>
  </div>
</section>
<section class="panel">
  <div class="title">ì—…ë¹„íŠ¸ ì‹¤ì‹œê°„ ì‹œì„¸ ì¹´ë“œ</div>
  <div id="cards" class="cards"></div>
  <div class="note">ì›¹ì†Œì¼“ ì‹¤ì‹œê°„ ìˆ˜ì‹  Â· ì‹¤íŒ¨ ì‹œ í´ë§ ì „í™˜</div>
</section>
<section class="panel">
  <div class="title">ì—…ë¹„íŠ¸ / ë¹—ì¸ í˜¸ê°€ì°½ (ìƒìœ„ 5)</div>
  <div class="row" style="grid-template-columns:1fr 1fr">
    <div>
      <div class="side"><span><b>ì—…ë¹„íŠ¸</b> (<span id="ub-sym">KRW-BTC</span>)</span><span class="pill" id="ub-last">-</span></div>
      <table class="table"><thead><tr><th>ë§¤ìˆ˜(í˜¸ê°€)</th><th>ìˆ˜ëŸ‰</th><th>ë§¤ë„(í˜¸ê°€)</th><th>ìˆ˜ëŸ‰</th></tr></thead><tbody id="ub-ob"></tbody></table>
    </div>
    <div>
      <div class="side"><span><b>ë¹—ì¸</b> (<span id="bt-sym">BTC_KRW</span>)</span><span class="pill" id="bt-last">-</span></div>
      <table class="table"><thead><tr><th>ë§¤ìˆ˜(í˜¸ê°€)</th><th>ìˆ˜ëŸ‰</th><th>ë§¤ë„(í˜¸ê°€)</th><th>ìˆ˜ëŸ‰</th></tr></thead><tbody id="bt-ob"></tbody></table>
    </div>
  </div>
</section>
<footer>Â© ì‚¬í† ì‹œì˜ì§€ê°‘ â€” ì°¸ê³ ìš©ì´ë©° íˆ¬ì ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.</footer>
</main>
<script>
const $=q=>document.querySelector(q);
const ding=new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAABkYXRhAAAAAAA=');
function beep(){ if(!$('#soundOn').checked) return; try{ding.currentTime=0; ding.play();}catch(_){ }}
function upbitTickSize(p){p=+p;if(p>=2000000)return 1000;if(p>=1000000)return 500;if(p>=500000)return 100;if(p>=100000)return 50;if(p>=10000)return 10;if(p>=1000)return 1;if(p>=100)return .1;if(p>=10)return .01;return .001}
function fmtKRW(x){const t=upbitTickSize(x);const f=(t>=1)?0:(t===.1?1:(t===.01?2:3));return Number(x).toLocaleString('ko-KR',{minimumFractionDigits:f,maximumFractionDigits:f})+' ì›'}
function parseKRW(s){return Number(String(s).replace(/[^0-9.]/g,''))||0}
const sleep=ms=>new Promise(r=>setTimeout(r,ms));
let MARKET_ALL=[]; let NAME_MAP=new Map(); let NAME_KR={}; let ALL_KRW_CODES=[];
async function loadMarkets(){ if(MARKET_ALL.length) return MARKET_ALL; const r=await fetch('https://api.upbit.com/v1/market/all?isDetails=true'); const j=await r.json(); MARKET_ALL=j.filter(o=>o.market.startsWith('KRW-')); NAME_MAP.clear(); NAME_KR={}; for(const o of MARKET_ALL){ NAME_MAP.set(o.market,o.market); if(o.korean_name) NAME_MAP.set(o.korean_name,o.market); if(o.english_name) NAME_MAP.set(String(o.english_name).toUpperCase(),o.market); NAME_KR[o.market]=o.korean_name||o.market;} ALL_KRW_CODES=MARKET_ALL.map(o=>o.market); return MARKET_ALL;}
function guessMarket(q){ q=(q||'').trim(); if(!q) return 'KRW-BTC'; if(NAME_MAP.has(q)) return NAME_MAP.get(q); const U=q.toUpperCase(); if(NAME_MAP.has(U)) return NAME_MAP.get(U); for(const o of MARKET_ALL){ if(o.korean_name?.includes(q) || String(o.english_name).toUpperCase().includes(U) || o.market===U) return o.market; } if(U.startsWith('KRW-')) return U; return 'KRW-BTC';}
let watch=['KRW-BTC','KRW-ETH','KRW-XRP','KRW-ADA']; let ws=null, wsHot=null, wsTimer=null; let hotSubscribed=0; const ring=new Map();
function addSample(cd,p){ const now=Date.now(); if(!ring.has(cd)) ring.set(cd,[]); const arr=ring.get(cd); arr.push({t:now,p}); const cutoff=now-7*24*60*60*1000; while(arr.length && arr[0].t<cutoff) arr.shift(); }
function winReturnPct(cd,ms){ const now=Date.now(); const arr=ring.get(cd)||[]; const from=now-ms; let a=null,b=null; for(const s of arr){ if(s.t<=from) a=s; else { b=arr[arr.length-1]; break; } } if(!a||!b) return null; return ((b.p-a.p)/a.p)*100; }
function renderCard(t){ const id=`card-${t.cd||t.market}`; let el=document.getElementById(id); const price=Number(t.tp||t.trade_price); const rate=Number(t.cr||t.signed_change_rate||0); const diff=Number(t.cp||t.signed_change_price||0); const cd=t.cd||t.market; const html=`<div class=\"title\">${NAME_KR[cd]||cd} (${cd})</div>`+`<div class=\"price\">${fmtKRW(price)}</div>`+`<div class=\"chg ${rate>=0?'ok':'bad'}\">${rate>=0?'ìƒìŠ¹':'í•˜ë½'} ${(rate*100).toFixed(2)}% (${diff>=0?'+':''}${fmtKRW(diff)})</div>`; if(!el){ el=document.createElement('div'); el.className='card'; el.id=id; document.getElementById('cards').appendChild(el);} el.innerHTML=html; if(document.getElementById('selUp').value===cd){ const prevCur=document.getElementById('cur').value; document.getElementById('cur').value=fmtKRW(price); if(document.getElementById('autoPlan').checked && prevCur!==document.getElementById('cur').value){ document.getElementById('entry').value=fmtKRW(price); calcPlan(); } } }
function wsConnect(){ try{ if(ws) try{ws.close();}catch(_){ } ws=new WebSocket('wss://api.upbit.com/websocket/v1'); ws.binaryType='arraybuffer'; ws.onopen=()=>{ ws.send(JSON.stringify([{ticket:'main'},{type:'ticker',codes:watch},{format:'SIMPLE'}])); }; ws.onmessage=(e)=>{ try{ const txt=new TextDecoder('utf-8').decode(new Uint8Array(e.data)); const o=JSON.parse(txt); if(!o?.cd||!o?.tp) return; renderCard(o); addSample(o.cd,Number(o.tp)); onTickAll(o.cd,Number(o.tp)); }catch(_){} }; ws.onclose=()=>{ clearTimeout(wsTimer); wsTimer=setTimeout(wsConnect,1500); }; ws.onerror=()=>{ try{ws.close();}catch(_){ } }; }catch(e){ console.warn('wsConnect',e); } }
function hotConnect(){ try{ if(wsHot) try{wsHot.close();}catch(_){ } wsHot=new WebSocket('wss://api.upbit.com/websocket/v1'); wsHot.binaryType='arraybuffer'; wsHot.onopen=()=>{ const chunk=80; hotSubscribed=0; for(let i=0;i<ALL_KRW_CODES.length;i+=chunk){ const group=ALL_KRW_CODES.slice(i,i+chunk); hotSubscribed+=group.length; wsHot.send(JSON.stringify([{ticket:'hot'},{type:'ticker',codes:group},{format:'SIMPLE'}])); } document.getElementById('hotStat').textContent=`ì—°ê²°ë¨ Â· ${hotSubscribed}ì¢…ëª©`; }; wsHot.onmessage=(e)=>{ try{ const txt=new TextDecoder('utf-8').decode(new Uint8Array(e.data)); const o=JSON.parse(txt); if(!o?.cd||!o?.tp) return; const cd=o.cd, price=Number(o.tp); addSample(cd,price); checkHot(cd,price); }catch(_){ document.getElementById('hotStat').textContent='ìˆ˜ì‹  ì—ëŸ¬'; } }; wsHot.onclose=()=>{ document.getElementById('hotStat').textContent='ì¬ì—°ê²° ì¤‘â€¦'; setTimeout(hotConnect,2000); }; wsHot.onerror=()=>{ try{wsHot.close();}catch(_){ } }; }catch(e){ console.warn('hotConnect',e); } }
let polling=false; async function startPolling(){ if(polling) return; polling=true; document.getElementById('hotStat').textContent='í´ë§ ëª¨ë“œ'; while(polling){ try{ const r=await fetch('https://api.upbit.com/v1/ticker?markets='+ALL_KRW_CODES.slice(0,200).join(',')); const j=await r.json(); if(Array.isArray(j)){ j.forEach(t=>{ const cd=t.market; const price=Number(t.trade_price); addSample(cd,price); if(watch.includes(cd)) renderCard({market:cd,trade_price:price,signed_change_rate:t.signed_change_rate,signed_change_price:t.signed_change_price}); checkHot(cd,price); }); } }catch(e){} await new Promise(r=>setTimeout(r,1500)); } }
const riseEl=document.getElementById('riseList'), fallEl=document.getElementById('fallList'), hotUpEl=document.getElementById('hotUpList'), hotDnEl=document.getElementById('hotDownList');
function pushLine(el,cd,pct,label,price){ const n=new Date(); const h=String(n.getHours()).padStart(2,'0'),m=String(n.getMinutes()).padStart(2,'0'),s=String(n.getSeconds()).padStart(2,'0'); const name=NAME_KR[cd]||cd; const li=document.createElement('li'); li.textContent=`[${h}:${m}:${s}] ${name} (${cd}) ${label} ${pct>0?'+':''}${pct.toFixed(2)}% (í˜„ì¬ ${fmtKRW(price)})`; el.prepend(li); if(el.children.length>30) el.removeChild(el.lastChild); beep(); }
const RISE_RULES=[{w:60_000,th:+2},{w:180_000,th:+5},{w:300_000,th:+8}], FALL_RULES=[{w:60_000,th:-2},{w:180_000,th:-5},{w:300_000,th:-8}];
const flagRise=new Map(), flagFall=new Map();
function checkRiseFall(cd,price){ const now=Date.now(); for(const r of RISE_RULES){ const p=winReturnPct(cd,r.w); if(p!==null&&p>=r.th){ const k=`R|${cd}|${r.w}`; if((flagRise.get(k)||0)+r.w/2<now){ flagRise.set(k,now); pushLine(riseEl,cd,p,`â–² (${r.w/1000}s)`,price);} } } for(const r of FALL_RULES){ const p=winReturnPct(cd,r.w); if(p!==null&&p<=r.th){ const k=`F|${cd}|${r.w}`; if((flagFall.get(k)||0)+r.w/2<now){ flagFall.set(k,now); pushLine(fallEl,cd,p,`â–¼ (${r.w/1000}s)`,price);} } } }
const SPK_UP=[{w:5_000,th:+0.5},{w:10_000,th:+0.9},{w:15_000,th:+1.2},{w:30_000,th:+2.0}], SPK_DN=[{w:5_000,th:-0.5},{w:10_000,th:-0.9},{w:15_000,th:-1.2},{w:30_000,th:-2.0}];
const flagHotU=new Map(), flagHotD=new Map();
function checkHot(cd,price){ const now=Date.now(); for(const r of SPK_UP){ const p=winReturnPct(cd,r.w); if(p!==null&&p>=r.th){ const k=`U|${cd}|${r.w}`; if((flagHotU.get(k)||0)+r.w/2<now){ flagHotU.set(k,now); pushLine(hotUpEl,cd,p,`â–² (${r.w/1000}s)`,price);} } } for(const r of SPK_DN){ const p=winReturnPct(cd,r.w); if(p!==null&&p<=r.th){ const k=`D|${cd}|${r.w}`; if((flagHotD.get(k)||0)+r.w/2<now){ flagHotD.set(k,now); pushLine(hotDnEl,cd,p,`â–¼ (${r.w/1000}s)`,price);} } } }
function onTickAll(cd,price){ checkRiseFall(cd,price); checkHot(cd,price); if(document.getElementById('selUp').value===cd && document.getElementById('autoPlan').checked){ document.getElementById('entry').value=fmtKRW(price); calcPlan(); } }
const ubOBEl=document.getElementById('ub-ob'), btOBEl=document.getElementById('bt-ob');
async function refreshOrderbooks(symUp='KRW-BTC', symBt='BTC_KRW'){ try{ const r1=await fetch(`https://api.upbit.com/v1/orderbook?markets=${symUp}`); const j1=await r1.json(); const ob=j1[0]?.orderbook_units||[]; document.getElementById('ub-sym').textContent=symUp; ubOBEl.innerHTML=''; for(let i=0;i<5;i++){ const b=ob[i]; if(!b)break; ubOBEl.insertAdjacentHTML('beforeend',`<tr><td class='ok'>${fmtKRW(b.bid_price)}</td><td>${Number(b.bid_size).toFixed(3)}</td><td class='bad'>${fmtKRW(b.ask_price)}</td><td>${Number(b.ask_size).toFixed(3)}</td></tr>`); } const base=symBt.split('_')[0]; const r2=await fetch(`https://api.bithumb.com/public/orderbook/${base}_KRW?count=5`); const j2=await r2.json(); document.getElementById('bt-sym').textContent=`${base}_KRW`; btOBEl.innerHTML=''; if(j2?.data){ const bids=j2.data.bids||[], asks=j2.data.asks||[]; for(let i=0;i<5;i++){ const br=bids[i], ar=asks[i]; if(!br&&!ar)break; btOBEl.insertAdjacentHTML('beforeend',`<tr><td class='ok'>${br?fmtKRW(br.price):''}</td><td>${br?Number(br.quantity).toFixed(3):''}</td><td class='bad'>${ar?fmtKRW(ar.price):''}</td><td>${ar?Number(ar.quantity).toFixed(3):''}</td></tr>`); } } }catch(e){} }
setInterval(()=>{ const L=document.getElementById('ub-sym').textContent||'KRW-BTC'; const R=document.getElementById('bt-sym').textContent||'BTC_KRW'; refreshOrderbooks(L,R); },5000);
async function fetchTicker(m){ const r=await fetch('https://api.upbit.com/v1/ticker?markets='+m); const j=await r.json(); return j[0]; }
async function updatePlanner(m){ try{ const t=await fetchTicker(m); if(!t) return; document.getElementById('cur').value=fmtKRW(t.trade_price); document.getElementById('entry').value=fmtKRW(t.trade_price); calcPlan(); buildReport(m); }catch(e){} }
function tickRound(px){ const t=upbitTickSize(px); const f=(t>=1)?0:(t===.1?1:(t===.01?2:3)); return Number(px.toFixed(f)); }
function calcPlan(){ const entry=parseKRW(document.getElementById('entry').value)||parseKRW(document.getElementById('cur').value); const slPct=Number(document.getElementById('slPct').value||0.8), tp1Pct=Number(document.getElementById('tp1Pct').value||1.2), tp2Pct=Number(document.getElementById('tp2Pct').value||2.5); const sl=tickRound(entry*(1-slPct/100)), tp1=tickRound(entry*(1+tp1Pct/100)), tp2=tickRound(entry*(1+tp2Pct/100)); document.getElementById('slPrice').textContent=fmtKRW(sl); document.getElementById('tp1Price').textContent=fmtKRW(tp1); document.getElementById('tp2Price').textContent=fmtKRW(tp2); const re1=sl, re2=tickRound(sl+(entry-sl)*0.5); document.getElementById('reBuyZone').textContent=`${fmtKRW(re1)} ~ ${fmtKRW(re2)}`; const d=new Date(); document.getElementById('lastPlanAt').textContent=`${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')}`; }
document.getElementById('btnFromCur').onclick=()=>{ const v=parseKRW(document.getElementById('cur').value); if(v) document.getElementById('entry').value=fmtKRW(v); };
document.getElementById('entry').addEventListener('blur',()=>{ const v=parseKRW(document.getElementById('entry').value); if(v) document.getElementById('entry').value=fmtKRW(v); });
document.getElementById('btnPlan').onclick=calcPlan;
async function buildReport(m){ try{ const r=await fetch(`https://api.upbit.com/v1/candles/days?market=${m}&count=200`); const j=await r.json(); if(!Array.isArray(j)||!j.length){ document.getElementById('marketReport').textContent='ì¼ë´‰ ë¡œë“œ ì‹¤íŒ¨'; return;} const close=j.map(o=>Number(o.trade_price)).reverse(); const last=close.at(-1); const ma=(n)=>{ if(close.length<n) return null; const out=[]; let s=0; for(let i=0;i<close.length;i++){ s+=close[i]; if(i>=n) s-=close[i-n]; if(i>=n-1) out.push(s/n);} return out.at(-1); }; function rsi(period=14){ if(close.length<period+1) return null; let g=0,l=0; for(let i=1;i<=period;i++){ const d=close[i]-close[i-1]; if(d>=0) g+=d; else l-=d; } let rs=g/Math.max(1,l); let r=100-(100/(1+rs)); for(let i=period+1;i<close.length;i++){ const d=close[i]-close[i-1]; const up=Math.max(0,d), dn=Math.max(0,-d); g=(g*(period-1)+up)/period; l=(l*(period-1)+dn)/period; rs=g/Math.max(1,l); r=100-(100/(1+rs)); } return r; } const ma20=ma(20), ma60=ma(60), ma200=ma(200), rsi14=rsi(14); const trend=x=>x? (last>x?'ìƒë°©':'í•˜ë°©'):'-'; const advice=(()=>{ if(ma200&& last>ma200 && rsi14 && rsi14<35) return 'âœ… ìƒìŠ¹ì¥ ëˆŒë¦¼: ë¶„í• ë§¤ìˆ˜'; if(rsi14 && rsi14>70) return 'âš ï¸ ê³¼ì—´: ë¶„í• ë§¤ë„/íŠ¸ë ˆì¼ë§'; if(ma60 && last<ma60 && ma200 && last>ma200) return 'ğŸ•’ ì¤‘ê¸° ì¡°ì •: ê´€ë§'; if(ma200 && last<ma200) return 'ğŸš« ì¥ê¸° í•˜ë½: ë³´ìˆ˜ì '; return 'ğŸ™‚ ì¤‘ë¦½: ì¶”ì„¸ í™•ì¸ ì¤‘'; })(); document.getElementById('marketReport').innerHTML=`<div class='grid2'><div class='kv'><span>í˜„ì¬ê°€</span><b>${fmtKRW(last)}</b></div><div class='kv'><span>MA200</span><b>${ma200?fmtKRW(ma200):'-'}</b></div><div class='kv'><span>ë‹¨ê¸°(20MA)</span><b>${trend(ma20)}</b></div><div class='kv'><span>ì¤‘ê¸°(60MA)</span><b>${trend(ma60)}</b></div><div class='kv'><span>ì¥ê¸°(200MA)</span><b>${trend(ma200)}</b></div><div class='kv'><span>RSI(14)</span><b>${rsi14?rsi14.toFixed(1):'-'}</b></div></div><div class='kv' style='margin-top:8px'><span>ì¶”ì²œ ì•¡ì…˜</span><b>${advice}</b></div>`; }catch(e){ document.getElementById('marketReport').textContent='ì‹œì¥ë¶„ì„ ì—ëŸ¬'; } }
async function onSearch(){ await loadMarkets(); const up=guessMarket(document.getElementById('q').value); document.getElementById('selUp').value=up; if(!watch.includes(up)){ watch=[up,...watch].slice(0,4); document.getElementById('cards').innerHTML=''; ws && ws.send && ws.send(JSON.stringify([{ticket:'main'},{type:'ticker',codes:watch},{format:'SIMPLE'}])); } const base=up.split('-')[1]; refreshOrderbooks(up,`${base}_KRW`); await updatePlanner(up); }
document.getElementById('btnSearch').onclick=onSearch;
document.getElementById('btnReset').onclick=async()=>{ document.getElementById('q').value=''; await loadMarkets(); const up='KRW-BTC'; document.getElementById('selUp').value=up; watch=['KRW-BTC','KRW-ETH','KRW-XRP','KRW-ADA']; document.getElementById('cards').innerHTML=''; ws && ws.send && ws.send(JSON.stringify([{ticket:'main'},{type:'ticker',codes:watch},{format:'SIMPLE'}])); refreshOrderbooks('KRW-BTC','BTC_KRW'); await updatePlanner(up); };
document.getElementById('q').addEventListener('keydown',e=>{ if(e.key==='Enter'&&!e.isComposing) document.getElementById('btnSearch').click(); });
(async function start(){ await loadMarkets(); await updatePlanner('KRW-BTC'); refreshOrderbooks('KRW-BTC','BTC_KRW'); wsConnect(); hotConnect(); setTimeout(()=>{ const any=document.querySelector('#cards .card'); if(!any){ startPolling(); } },10000); })();
window.addEventListener('beforeunload',()=>{ try{ws&&ws.close();}catch(_){ } try{wsHot&&wsHot.close();}catch(_){ } });
</script>
</body></html>